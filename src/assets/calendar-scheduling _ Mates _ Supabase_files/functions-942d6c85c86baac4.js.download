!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="888e14f2-48b9-4125-bc6d-3cb7f2663239",e._sentryDebugIdIdentifier="sentry-dbid-888e14f2-48b9-4125-bc6d-3cb7f2663239")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1753,8426],{10585:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var n=s(80263),a=s(55866);let i=e=>{let{resourceText:t,isFullPage:s=!1}=e,i=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(a.A,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,n.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,n.jsx)("div",{className:"w-[550px]",children:(0,n.jsx)(i,{})})}):(0,n.jsx)(i,{})}},38543:(e,t,s)=>{"use strict";s.d(t,{e:()=>o});var n=s(45874),a=s(56947),i=s(95059),l=s(96557);let r=n.A.functions.list();async function c(e,t,s){let{projectRef:n,connectionString:a}=e,i=new Headers(s),{result:c}=await (0,l.E)({projectRef:n,connectionString:a,sql:r.sql,queryKey:["database-functions"]},t,i);return c}let o=function(e){let{projectRef:t,connectionString:s}=e,{enabled:n=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(i.c.databaseFunctions(t),e=>{let{signal:n}=e;return c({projectRef:t,connectionString:s},n)},{enabled:n&&void 0!==t,...l})}},46610:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var n=s(80263),a=s(77877),i=s(41370),l=s(59153),r=s.n(l),c=s(71126);let o=e=>{let{title:t="",size:s="medium",children:l,ctaButtonLabel:o="",infoButtonLabel:d="",infoButtonUrl:u="",onClickCta:x=()=>{},loading:f=!1,disabled:h=!1,disabledMessage:m="",ctaUrl:p}=e,j=o&&x||u&&d;return(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center","data-sentry-component":"ProductEmptyState","data-sentry-source-file":"ProductEmptyState.tsx",children:(0,n.jsx)("div",{className:"flex space-x-4 rounded border bg-surface-100 p-6 shadow-md",children:(0,n.jsx)("div",{className:"flex flex-col",children:(0,n.jsxs)("div",{className:"".concat("medium"===s?"w-80":"w-[400px]"," space-y-4"),children:[(0,n.jsx)("h5",{className:"text-foreground",children:t}),(0,n.jsx)("div",{className:"flex flex-col space-y-2 text-foreground-light",children:l}),j&&(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[o&&p?(0,n.jsx)(c.$,{asChild:!0,type:"primary",children:(0,n.jsx)(r(),{href:p,children:o})}):o&&x?(0,n.jsx)(i.G,{type:"primary",onClick:x,loading:f,disabled:f||h,tooltip:{content:{side:"bottom",text:h&&m.length>0?m:void 0}},children:o}):null,u&&d?(0,n.jsx)(c.$,{type:"default",icon:(0,n.jsx)(a.A,{strokeWidth:1.5}),children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:u,children:d})}):null]})]})})})})}},55315:(e,t,s)=>{var n=s(71057);e.exports=function(e,t){return n(t,function(t){return e[t]})}},61741:(e,t,s)=>{var n=s(55315),a=s(24967);e.exports=function(e){return null==e?[]:n(e,a(e))}},65385:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Z});var n=s(80263),a=s(60045),i=s(53239),l=s(90915),r=s(95584),c=s(83927),o=s.n(c),d=s(53667),u=s.n(d),x=s(95285),f=s(47504),h=s(19898),m=s(97872),p=s(46610),j=s(80125),g=s(48153),y=s(41370),N=s(4487),b=s(96457),v=s(38543),w=s(788),A=s(77227),_=s(25321),S=s(82008),C=s(89634),k=s(16988),E=s(83026),L=s(43970),F=s(86926),I=s.n(F),P=s(14506),R=s.n(P),D=s(1051),T=s(90921),z=s(69368),M=s(15576),U=s(28097),$=s(71126),G=s(74115);let Q=e=>{let{schema:t,filterString:s,isLocked:i,editFunction:l=o(),deleteFunction:r=o()}=e,c=(0,f.useRouter)(),{project:d}=(0,m.Om)(),u=(0,C.xd)(),{data:x}=(0,v.e)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),h=(null!=x?x:[]).filter(e=>I()(e.name.toLowerCase(),s.toLowerCase())),p=R()(h.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),g=null==d?void 0:d.ref,N=(0,A.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"functions");return 0===p.length&&0===s.length?(0,n.jsx)(j.A.tr,{children:(0,n.jsxs)(j.A.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No functions created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no functions found in the schema "',t,'"']})]})},t):0===p.length&&s.length>0?(0,n.jsx)(j.A.tr,{children:(0,n.jsxs)(j.A.td,{colSpan:5,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',s,'" did not return any results']})]})},t):(0,n.jsx)(n.Fragment,{children:p.map(e=>{let s="public"==t&&"trigger"!==e.return_type;return(0,n.jsxs)(j.A.tr,{children:[(0,n.jsx)(j.A.td,{className:"truncate",children:(0,n.jsx)($.$,{type:"text",className:"text-foreground text-sm p-0 hover:bg-transparent",onClick:()=>l(e),children:e.name})}),(0,n.jsx)(j.A.td,{className:"table-cell overflow-auto",children:(0,n.jsx)("p",{title:e.argument_types,className:"truncate",children:e.argument_types||"-"})}),(0,n.jsx)(j.A.td,{className:"table-cell",children:(0,n.jsx)("p",{title:e.return_type,children:e.return_type})}),(0,n.jsx)(j.A.td,{className:"table-cell",children:e.security_definer?"Definer":"Invoker"}),(0,n.jsx)(j.A.td,{className:"text-right",children:!i&&(0,n.jsx)("div",{className:"flex items-center justify-end",children:N?(0,n.jsxs)(G.rI,{children:[(0,n.jsx)(G.ty,{asChild:!0,children:(0,n.jsx)($.$,{type:"default",className:"px-1",icon:(0,n.jsx)(D.A,{})})}),(0,n.jsxs)(G.SQ,{side:"left",className:"w-52",children:[s&&(0,n.jsxs)(G._2,{className:"space-x-2",onClick:()=>c.push("/project/".concat(g,"/api?rpc=").concat(e.name)),children:[(0,n.jsx)(T.A,{size:14}),(0,n.jsx)("p",{children:"Client API docs"})]}),(0,n.jsxs)(G._2,{className:"space-x-2",onClick:()=>l(e),children:[(0,n.jsx)(z.A,{size:14}),(0,n.jsx)("p",{children:"Edit function"})]}),(0,n.jsxs)(G._2,{className:"space-x-2",onClick:()=>{u.newChat({name:"Update function ".concat(e.name),open:!0,initialInput:"Update this function to do...",suggestions:{title:"I can help you make a change to this function, here are a few example prompts to get you started:",prompts:["Rename this function to ...","Modify this function so that it ...","Add a trigger for this function that calls it when ..."]},sqlSnippets:[e.complete_statement]})},children:[(0,n.jsx)(M.A,{size:14}),(0,n.jsx)("p",{children:"Edit function with Assistant"})]}),(0,n.jsx)(G.mB,{}),(0,n.jsxs)(G._2,{className:"space-x-2",onClick:()=>r(e),children:[(0,n.jsx)(U.A,{size:14,className:"text-destructive"}),(0,n.jsx)("p",{children:"Delete function"})]})]})]}):(0,n.jsx)(y.G,{disabled:!0,type:"default",icon:(0,n.jsx)(D.A,{}),className:"px-1",tooltip:{content:{side:"left",text:"You need additional permissions to update functions"}}})})})]},e.id)})})},q=e=>{let{createFunction:t=o(),editFunction:s=o(),deleteFunction:i=o()}=e,l=(0,f.useRouter)(),{search:r}=(0,h.g)(),{project:c}=(0,m.Om)(),d=(0,C.xd)(),{selectedSchema:F,setSelectedSchema:I}=(0,_.k)(),P=null!=r?r:"",R=e=>{let t=new URL(document.URL);""===e?t.searchParams.delete("search"):t.searchParams.set("search",e),l.push(t)},D=(0,A.SE)(a.aG.TENANT_SQL_ADMIN_WRITE,"functions"),{data:T}=(0,w.w$)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),[z]=u()(null!=T?T:[],e=>{var t;return S.i.includes(null!=(t=null==e?void 0:e.name)?t:"")}),M=null==T?void 0:T.find(e=>e.name===F),U=z.some(e=>e.id===(null==M?void 0:M.id)),{data:$,error:G,isLoading:q,isError:O}=(0,v.e)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString});return q?(0,n.jsx)(b.y,{}):O?(0,n.jsx)(g.A,{error:G,subject:"Failed to retrieve database functions"}):(0,n.jsx)(n.Fragment,{children:0==(null!=$?$:[]).length?(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)(p.A,{title:"Functions",ctaButtonLabel:"Create a new function",onClickCta:()=>t(),disabled:!D,disabledMessage:"You need additional permissions to create functions",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"PostgreSQL functions, also known as stored procedures, is a set of SQL and procedural commands such as declarations, assignments, loops, flow-of-control, etc."}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"It's stored on the database server and can be invoked using the SQL interface."})]})}):(0,n.jsxs)("div",{className:"w-full space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,n.jsx)(N.A,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:F,onSelectSchema:e=>{let t=new URL(document.URL);t.searchParams.delete("search"),l.push(t),I(e)}}),(0,n.jsx)(k.A,{placeholder:"Search for a function",size:"tiny",icon:(0,n.jsx)(x.A,{size:14}),value:P,className:"w-full lg:w-52",onChange:e=>R(e.target.value)})]}),(0,n.jsx)("div",{className:"flex items-center gap-x-2",children:!U&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.G,{disabled:!D,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:D?void 0:"You need additional permissions to create functions"}},children:"Create a new function"}),(0,n.jsx)(y.G,{type:"default",disabled:!D,className:"px-1 pointer-events-auto",icon:(0,n.jsx)(E.M,{size:16}),onClick:()=>d.newChat({name:"Create new function",open:!0,initialInput:"Create a new function for the schema ".concat(F," that does ...")}),tooltip:{content:{side:"bottom",text:D?"Create with Supabase Assistant":"You need additional permissions to create functions"}}})]})})]}),U&&(0,n.jsx)(L.A,{schema:F,entity:"functions"}),(0,n.jsx)(j.A,{className:"table-fixed overflow-x-auto",head:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.A.th,{children:"Name"},"name"),(0,n.jsx)(j.A.th,{className:"table-cell",children:"Arguments"},"arguments"),(0,n.jsx)(j.A.th,{className:"table-cell",children:"Return type"},"return_type"),(0,n.jsx)(j.A.th,{className:"table-cell w-[100px]",children:"Security"},"security"),(0,n.jsx)(j.A.th,{className:"w-1/6"},"buttons")]}),body:(0,n.jsx)(Q,{schema:F,filterString:P,isLocked:U,editFunction:s,deleteFunction:i})})]})})};var O=s(25549),Y=s(1053),V=s(40402),W=s(76448),B=s(10585),H=s(22787);let X=()=>{let[e,t]=(0,i.useState)(),[s,c]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),{setEditorPanel:u}=(0,H.qM)(),x=(0,l.h4)(),f=(0,A.SE)(a.aG.TENANT_SQL_ADMIN_READ,"functions");return(0,A.Lh)()&&!f?(0,n.jsx)(B.A,{isFullPage:!0,resourceText:"view database functions"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(V.eh,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"functions.tsx",children:(0,n.jsx)(V.gu,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"functions.tsx",children:(0,n.jsxs)("div",{className:"col-span-12",children:[(0,n.jsx)(W.M,{title:"Database Functions",docsUrl:"https://supabase.com/docs/guides/database/functions","data-sentry-element":"FormHeader","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(q,{createFunction:()=>{x?u({open:!0,initialValue:"create function function_name()\nreturns void\nlanguage plpgsql\nas $$\nbegin\n  -- Write your function logic here\nend;\n$$;",label:"Create new database function",saveLabel:"Create function",initialPrompt:"Create a new database function that..."}):(t(void 0),c(!0))},editFunction:e=>{x?u({open:!0,initialValue:e.complete_statement,label:'Edit function "'.concat(e.name,'"'),saveLabel:"Update function",initialPrompt:'Update the database function "'.concat(e.name,'" to...')}):(t(e),c(!0))},deleteFunction:e=>{t(e),d(!0)},"data-sentry-element":"FunctionsList","data-sentry-source-file":"functions.tsx"})]})})}),(0,n.jsx)(r.ZO,{func:e,visible:s,setVisible:c,"data-sentry-element":"CreateFunction","data-sentry-source-file":"functions.tsx"}),(0,n.jsx)(r.iZ,{func:e,visible:o,setVisible:d,"data-sentry-element":"DeleteFunction","data-sentry-source-file":"functions.tsx"})]})};X.getLayout=e=>(0,n.jsx)(Y.A,{children:(0,n.jsx)(O.A,{title:"Database",children:e})});let Z=X},69368:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(23983).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},79109:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/functions",function(){return s(65385)}])},86926:(e,t,s)=>{var n=s(35902),a=s(89527),i=s(22442),l=s(80544),r=s(61741),c=Math.max;e.exports=function(e,t,s,o){e=a(e)?e:r(e),s=s&&!o?l(s):0;var d=e.length;return s<0&&(s=c(d+s,0)),i(e)?s<=d&&e.indexOf(t,s)>-1:!!d&&n(e,t,s)>-1}}},e=>{var t=t=>e(e.s=t);e.O(0,[89,4335,2147,726,4669,9353,7176,3730,9844,6110,9955,6871,8153,5297,5661,4100,8870,2981,4181,2187,4560,7344,3895,1959,9116,9869,4938,5758,7872,5874,49,2174,971,6642,8434,2602,99,6544,6593,636,8792],()=>t(79109)),_N_E=e.O()}]);