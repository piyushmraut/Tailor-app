!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0b478dc4-baf7-4442-9e5d-727ab3636200",e._sentryDebugIdIdentifier="sentry-dbid-0b478dc4-baf7-4442-9e5d-727ab3636200")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7872],{4327:(e,t,o)=>{o.d(t,{PE:()=>u,Rd:()=>h,Uh:()=>m,Ym:()=>c,fU:()=>d,iN:()=>p,ok:()=>i});var a=o(73969),n=o(64588),l=o(51527),r=o(99325),s=o(81018);let i=".emptyFolderPlaceholder",c=(e,t)=>{let o=e.slice(0,t.columnIndex).map(e=>e.name),n=o.length>0?"".concat(o.join("/"),"/").concat(t.name):t.name;(0,l.l)(n),a.oR.success('Copied path to folder "'.concat(t.name,'"'))},d=e=>{let t=Math.floor(e/86400),o=Math.floor((e%=86400)/3600),a=Math.floor((e%=3600)/60);return(e=Math.floor(e%60),t>0)?"".concat(t,"d "):o>0?"".concat(o,"h "):a>0?"".concat(a,"m "):"".concat(e,"s")},u=async e=>{var t,o,l;let{projectRef:s,bucketId:i,file:c,showToast:d=!0,returnBlob:u=!1}=e;if(!s)return a.oR.error("Failed to download: Project ref is required");if(!i)return a.oR.error("Failed to download: Bucket ID is required");if(!c.path)return a.oR.error("Failed to download: Unable to find path to file");let m=c.name,p=null!=(o=null==c||null==(t=c.metadata)?void 0:t.mimetype)?o:void 0,f=d?a.oR.loading("Retrieving ".concat(m,"...")):void 0;try{let e=await (0,n.c)({projectRef:s,bucketId:i,path:c.path}),t=await e.blob(),o=new Blob([t],{type:p});if(u)return{name:m,blob:o};let d=window.URL.createObjectURL(o),h=document.createElement("a");return h.href=d,h.setAttribute("download","".concat(m)),document.body.appendChild(h),h.click(),null==(l=h.parentNode)||l.removeChild(h),window.URL.revokeObjectURL(t),f&&a.oR.success("Downloading ".concat(m),{id:f,closeButton:!0,duration:r.j}),!0}catch(e){return f&&a.oR.error("Failed to download ".concat(m),{id:f,closeButton:!0,duration:r.j}),!1}},m=e=>{let t=0,o=0;return e.forEach(e=>{if(0===(o+=e.remainingBytes))return;let a=e.remainingBytes/o;t+=a*e.remainingTime}),t},p=function(){var e,t;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;return null!=(t=null==(e=null!=o?o:[])?void 0:e.filter(e=>e.name!==i).map(e=>{let t=e.id?s.Vl.FILE:s.Vl.FOLDER,o=Number(new Date)-Number(new Date(e.created_at)),n=t===s.Vl.FILE&&!e.metadata&&o>=9e5,l=t===s.Vl.FILE&&!e.metadata&&o<=9e5?s.U1.LOADING:s.U1.READY;return{...e,metadata:e.metadata,type:t,status:l,isCorrupted:n,path:a?"".concat(a,"/").concat(e.name):e.name}}))?t:[]},f=async e=>{try{return await new Promise((t,o)=>e.file(t,o))}catch(e){console.error("getFile error:",e);return}},h=async e=>{let t=(0,a.oR)("Retrieving items to upload..."),o=[],n=[];for(let t of e){let e=t.webkitGetAsEntry();e&&n.push(e)}for(;n.length>0;){let e=n.shift();if(e&&e.isFile){let t=await f(e);void 0!==t&&(t.path=e.fullPath.slice(1),o.push(t))}else e&&e.isDirectory&&n.push(...await g(e.createReader()))}return a.oR.dismiss(t),o},g=async e=>{let t=[],o=await v(e);for(;o&&o.length>0;)t.push(...o),o=await v(e);return t},v=async e=>{try{return await new Promise((t,o)=>{e.readEntries(t,o)})}catch(e){console.error("readEntriesPromise error:",e)}}},30672:(e,t,o)=>{o.d(t,{Jb:()=>n,OG:()=>l,yO:()=>r});var a=o(77952);let n=(e,t)=>{if(e<=0)return{value:0,unit:a.s.BYTES};let o=void 0!==t?Object.values(a.s).indexOf(t):Math.floor(Math.log(e)/Math.log(1024)),n=void 0!==t?o<0?0:o:o>3?3:o,l=Object.values(a.s)[n];return{value:e/Math.pow(1024,n),unit:l}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.s.BYTES,o=Object.values(a.s).indexOf(t);return e<0||o<0?0:e*Math.pow(1024,o)};function r(e,t,o){let a=new URL(o?"".concat(t,"://").concat(o):"https://".concat(e,".supabase.co"));return a.pathname="/storage/v1/s3",a.toString()}},32036:(e,t,o)=>{o.d(t,{ME:()=>f,Qj:()=>g,RY:()=>h,_c:()=>y,sc:()=>v});var a=o(80263),n=o(53239),l=o(56028),r=o(12532),s=o(19898),i=o(96557),c=o(87936),d=o(68875),u=o(81979);function m(e,t){let o=(0,l.BX)({projectRef:e,role:void 0,claims:void 0,setRole:async(a,n)=>{let l=(null==a?void 0:a.type)==="postgrest"?(0,u.bL)(e,a):void 0;if((null==n?void 0:n.type)==="postgres"&&void 0!==l){let{schema:e,functionName:o}=n,a=await t.current({schema:e,functionName:o,claims:l});a&&(l=a)}o.role=a,l&&(o.claims=l)}});return o}let p=(0,n.createContext)(m("",{current:async()=>{}})),f=e=>{let{children:t}=e,o=(0,d.KT)();async function n(e){var t,a,n;let{schema:l,functionName:r,claims:s}=e,c={user_id:s.sub,claims:s,authentication_method:"password"},d=await (0,i.E)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,sql:"select ".concat(l,".").concat(r,"('").concat(JSON.stringify(c),"'::jsonb) as event;"),queryKey:["customize-access-token",null==o?void 0:o.ref]});return null==d||null==(n=d.result)||null==(a=n[0])||null==(t=a.event)?void 0:t.claims}let l=(0,c.A)(n),r=(0,s.MF)(()=>{var e;return m(null!=(e=null==o?void 0:o.ref)?e:"",l)});return(0,a.jsx)(p.Provider,{value:r,"data-sentry-element":"unknown","data-sentry-component":"RoleImpersonationStateContextProvider","data-sentry-source-file":"role-impersonation-state.tsx",children:t})};function h(e){let t=(0,n.useContext)(p);return(0,r.s)(t,e)}function g(){let e=(0,n.useContext)(p);return(0,n.useCallback)(()=>(0,l.P9)(e),[e])}function v(e){let t=(0,n.useContext)(p),o=(0,c.A)(e);(0,n.useEffect)(()=>(0,l.B1)(t,()=>{o.current((0,l.P9)(t).role)}),[t])}function y(e){return(null==e?void 0:e.type)==="postgrest"}},39321:(e,t,o)=>{o.d(t,{ap:()=>u,by:()=>d,to:()=>s});var a=o(80263),n=o(53239),l=o(56028),r=o(12532);let s=100,i=()=>{let e=(0,l.BX)({rowsPerPage:s,setRowsPerPage:t=>{e.rowsPerPage=t},ui:{open:"none"},get sidePanel(){return"side-panel"===e.ui.open?e.ui.sidePanel:void 0},get confirmationDialog(){return"confirmation-dialog"===e.ui.open?e.ui.confirmationDialog:void 0},closeSidePanel:()=>{e.ui={open:"none"}},closeConfirmationDialog:()=>{e.ui={open:"none"}},onAddSchema:()=>{e.ui={open:"side-panel",sidePanel:{type:"schema",mode:"new"}}},onAddTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"new"}}},onEditTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"edit"}}},onDuplicateTable:()=>{e.ui={open:"side-panel",sidePanel:{type:"table",mode:"duplicate"}}},onDeleteTable:()=>{e.ui={open:"confirmation-dialog",confirmationDialog:{type:"table",isDeleteWithCascade:!1}}},onAddColumn:()=>{e.ui={open:"side-panel",sidePanel:{type:"column"}}},onEditColumn:t=>{e.ui={open:"side-panel",sidePanel:{type:"column",column:t}}},onDeleteColumn:t=>{e.ui={open:"confirmation-dialog",confirmationDialog:{type:"column",column:t,isDeleteWithCascade:!1}}},onAddRow:()=>{e.ui={open:"side-panel",sidePanel:{type:"row"}}},onEditRow:t=>{e.ui={open:"side-panel",sidePanel:{type:"row",row:t}}},onDeleteRows:function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{numRows:0,allRowsSelected:!1,callback:()=>{}},{numRows:a,allRowsSelected:n,callback:l}=o;e.ui={open:"confirmation-dialog",confirmationDialog:{type:"row",rows:t,numRows:a,allRowsSelected:n,callback:l}}},onExpandJSONEditor:t=>{e.ui={open:"side-panel",sidePanel:{type:"json",jsonValue:t}}},onExpandTextEditor:(t,o)=>{e.ui={open:"side-panel",sidePanel:{type:"cell",value:{column:t,row:o}}}},onEditForeignKeyColumnValue:t=>{e.ui={open:"side-panel",sidePanel:{type:"foreign-row-selector",foreignKey:t}}},onImportData:()=>{e.ui={open:"side-panel",sidePanel:{type:"csv-import"}}},toggleConfirmationIsWithCascade:t=>{"confirmation-dialog"===e.ui.open&&("column"===e.ui.confirmationDialog.type||"table"===e.ui.confirmationDialog.type)&&(e.ui.confirmationDialog.isDeleteWithCascade=null!=t?t:!e.ui.confirmationDialog.isDeleteWithCascade)}});return e},c=(0,n.createContext)(i()),d=e=>{let{children:t}=e,o=(0,n.useRef)(i()).current;return(0,a.jsx)(c.Provider,{value:o,"data-sentry-element":"unknown","data-sentry-component":"TableEditorStateContextProvider","data-sentry-source-file":"table-editor.tsx",children:t})},u=e=>{let t=(0,n.useContext)(c);return(0,r.s)(t,e)}},42230:(e,t,o)=>{let a;o.d(t,{y:()=>et,$:()=>eo});var n=o(80263),l=o(77341),r=o.n(l),s=o(62140),i=o.n(s),c=o(93896),d=o.n(c),u=o(48388),m=o.n(u),p=o(38280),f=o.n(p),h=o(14685),g=o.n(h),v=o(64676),y=o.n(v),w=o(74722),I=o.n(w),x=o(86727),R=o.n(x),b=o(53239),S=o(14251),E=o(73969),A=o(80896),C=o(56028),j=o(12532),F=o(82147),P=o(99715),D=o(19898),T=o(81018),B=o(4327),k=o(30672),O=o(19362),N=o(20010),U=o(16599),L=o(64683),M=o(40807);let _=async(e,t)=>{let{projectRef:o,bucketId:a,paths:n}=e;if(!a)throw Error("bucketId is required");let{data:l,error:r}=await (0,M.yH)("/platform/storage/{ref}/buckets/{id}/objects",{params:{path:{ref:o,id:a}},body:{paths:n},signal:t});return r&&(0,M.H4)(r),l};var G=o(64588);let z=async(e,t)=>{let{projectRef:o,bucketId:a,path:n,options:l}=e;if(!a)throw Error("bucketId is required");let{data:r,error:s}=await (0,M.bE)("/platform/storage/{ref}/buckets/{id}/objects/list",{params:{path:{ref:o,id:a}},body:{path:n,options:l},signal:t});return s&&(0,M.H4)(s),r},Y=async e=>{let{projectRef:t,bucketId:o,from:a,to:n}=e;if(!o)throw Error("bucketId is required");let{data:l,error:r}=await (0,M.bE)("/platform/storage/{ref}/buckets/{id}/objects/move",{params:{path:{ref:t,id:o}},body:{from:a,to:n}});return r&&(0,M.H4)(r),l};var q=o(68875),V=o(64036),K=o(49443);let H=Object.fromEntries(Object.entries(o(32505)).filter(e=>{let[,{extensions:t}]=e;return void 0!==t}).flatMap(e=>{let[t,{extensions:o}]=e;return o.map(e=>[e.toLowerCase(),t])}));var J=o(73535),W=o(99325),X=o(71126);let Z={view:T.JB.COLUMNS,sortBy:T.NA.NAME,sortByOrder:T.ou.ASC};function $(e){var t;let{projectRef:o,resumableUploadUrl:l,serviceKey:s,supabaseClient:c}=e,u=D.rS.STORAGE_PREFERENCE(o),{view:p,sortBy:h,sortByOrder:v}=(0,K.Bl)(null==(t=localStorage)?void 0:t.getItem(u))||Z,w=(0,C.BX)({projectRef:o,supabaseClient:c,resumableUploadUrl:l,serviceKey:s,uploadProgresses:[],abortApiCalls:()=>{a&&(a.abort(),a=new AbortController)},abortUploadCallbacks:{},abortUploads:e=>{w.abortUploadCallbacks[e].forEach(e=>e()),w.abortUploadCallbacks[e]=[]},columns:[],popColumn:()=>{w.abortApiCalls(),w.columns=w.columns.slice(0,w.getLatestColumnIndex())},popColumnAtIndex:e=>{w.columns=w.columns.slice(0,e+1)},pushColumnAtIndex:(e,t)=>{w.columns=w.columns.slice(0,t+1).concat([e])},openedFolders:[],pushOpenedFolderAtIndex:(e,t)=>{w.openedFolders=w.openedFolders.slice(0,t).concat(e)},popOpenedFolders:()=>{w.openedFolders=w.openedFolders.slice(0,w.openedFolders.length-1)},popOpenedFoldersAtIndex:e=>{w.openedFolders=w.openedFolders.slice(0,e+1)},clearOpenedFolders:()=>{w.openedFolders=[]},selectedItems:[],setSelectedItems:e=>w.selectedItems=e,clearSelectedItems:e=>{void 0!==e?w.selectedItems=w.selectedItems.filter(t=>t.columnIndex!==e):w.selectedItems=[]},selectedItemsToDelete:[],setSelectedItemsToDelete:e=>{w.selectedItemsToDelete=e},selectedItemsToMove:[],setSelectedItemsToMove:e=>{w.selectedItemsToMove=e},selectedBucket:{},setSelectedBucket:e=>{w.selectedBucket=e,w.setSelectedFilePreview(void 0),w.clearOpenedFolders(),w.clearSelectedItems()},setSelectedItemToRename:e=>{w.updateRowStatus({name:e.name,status:T.U1.EDITING,columnIndex:e.columnIndex})},view:p,setView:e=>{w.view=e,w.updateExplorerPreference()},sortBy:h,setSortBy:async e=>{w.sortBy=e,w.updateExplorerPreference(),w.setSelectedFilePreview(void 0),await w.refetchAllOpenedFolders()},sortByOrder:v,setSortByOrder:async e=>{w.sortByOrder=e,w.updateExplorerPreference(),w.setSelectedFilePreview(void 0),await w.refetchAllOpenedFolders()},isSearching:!1,setIsSearching:e=>w.isSearching=e,selectedFilePreview:void 0,setSelectedFilePreview:e=>w.selectedFilePreview=e,selectedFileCustomExpiry:void 0,setSelectedFileCustomExpiry:e=>w.selectedFileCustomExpiry=e,updateExplorerPreference:()=>{let e=D.rS.STORAGE_PREFERENCE(o),{view:t,sortBy:a,sortByOrder:n}=w;localStorage.setItem(e,JSON.stringify({view:t,sortBy:a,sortByOrder:n}))},getLatestColumnIndex:()=>w.columns.length-1,setColumnIsLoadingMore:function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];w.columns=w.columns.map((o,a)=>a===e?{...o,isLoadingMoreItems:t}:o)},openBucket:async e=>{let{id:t,name:o}=e;w.setSelectedBucket(e),await w.fetchFolderContents({bucketId:e.id,folderId:t,folderName:o,index:-1})},getPathAlongOpenedFolders:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return e?w.openedFolders.length>0?"".concat(w.selectedBucket.name,"/").concat(w.openedFolders.map(e=>e.name).join("/")):w.selectedBucket.name:w.openedFolders.map(e=>e.name).join("/")},getPathAlongFoldersToIndex:e=>w.openedFolders.slice(0,e).map(e=>e.name).join("/"),addNewFolderPlaceholder:e=>{let t=T.Vl.FOLDER,o=-1===e?w.getLatestColumnIndex():e;w.addTempRow({type:t,name:"Untitled folder",status:T.U1.EDITING,columnIndex:o,metadata:null,isPrepend:!0})},addNewFolder:async(e,t)=>{if(!w.supabaseClient)return console.error("Supabase Client is missing");let o=w.sanitizeNameForDuplicateInColumn({name:e,autofix:!1,columnIndex:t});if(null===o)return;if(!/^[a-zA-Z0-9_-\s]*$/.test(o))return E.oR.error("Folder name contains invalid special characters");if(0===o.length)return w.removeTempRows(t);w.updateFolderAfterEdit({folderName:o,columnIndex:t});let a="".concat(o,"/").concat(B.ok),n=w.openedFolders.slice(0,t).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(a):a;await w.supabaseClient.storage.from(w.selectedBucket.name).upload(l,new File([],B.ok)),n.length>0&&await _({projectRef:w.projectRef,bucketId:w.selectedBucket.id,paths:["".concat(n,"/").concat(B.ok)]})},fetchFolderContents:async e=>{let{bucketId:t,folderId:o,folderName:n,index:l,searchString:r}=e;w.abortApiCalls(),w.updateRowStatus({name:n,status:T.U1.LOADING,columnIndex:l}),w.pushColumnAtIndex({id:o,name:n,status:T.U1.LOADING,items:[]},l);let s=w.openedFolders.slice(0,l+1).map(e=>e.name).join("/"),i={limit:200,offset:0,search:r,sortBy:{column:w.sortBy,order:w.sortByOrder}};try{let e=await z({bucketId:t,projectRef:w.projectRef,path:s,options:i},null==a?void 0:a.signal);w.updateRowStatus({name:n,status:T.U1.READY,columnIndex:l});let r=(0,B.iN)(e,s);w.pushColumnAtIndex({id:o||n,name:n,status:T.U1.READY,items:r,hasMoreItems:200===r.length,isLoadingMoreItems:!1},l)}catch(e){"AbortError"===e.name?w.updateRowStatus({name:n,status:T.U1.READY,columnIndex:l}):E.oR.error('Failed to retrieve folder contents from "'.concat(n,'": ').concat(e.message))}},fetchMoreFolderContents:async e=>{let{index:t,column:o,searchString:n=""}=e;w.setColumnIsLoadingMore(t);let l=w.openedFolders.map(e=>e.name).join("/"),r={limit:200,offset:o.items.length,search:n,sortBy:{column:w.sortBy,order:w.sortByOrder}};try{let e=await z({projectRef:w.projectRef,bucketId:w.selectedBucket.id,path:l,options:r},null==a?void 0:a.signal),o=(0,B.iN)(e,l);w.columns=w.columns.map((a,n)=>n===t?{...a,items:a.items.concat(o),isLoadingMoreItems:!1,hasMoreItems:200===e.length}:a)}catch(e){e.message.includes("aborted")||E.oR.error("Failed to retrieve more folder contents: ".concat(e.message))}},refetchAllOpenedFolders:async()=>{let e=w.openedFolders.map(e=>e.name);await w.fetchFoldersByPath({paths:e})},fetchFoldersByPath:async e=>{let{paths:t,searchString:o="",showLoading:a=!1}=e;if(void 0===w.selectedBucket.id)return;let n=[""].concat(t);a&&(w.columns=[w.selectedBucket.name].concat(t).map(e=>({id:e,name:e,status:T.U1.LOADING,items:[]})));let l=(await Promise.all(n.map(async(e,a)=>{let n=t.slice(0,a).join("/"),l={limit:200,offset:0,search:o,sortBy:{column:w.sortBy,order:w.sortByOrder}};try{return await z({projectRef:w.projectRef,bucketId:w.selectedBucket.id,path:n,options:l})}catch(e){return E.oR.error("Failed to fetch folders: ".concat(e.message)),[]}}))).map((e,o)=>{let a=t.slice(0,o).join("/"),l=(0,B.iN)(e,a);return{id:null,status:T.U1.READY,name:0===o?w.selectedBucket.name:n[o],items:l,hasMoreItems:200===l.length,isLoadingMoreItems:!1}});w.columns=l,w.openedFolders=t.map((e,t)=>{let o=m()(l[t].items,{name:e});return o||{id:null,name:e,type:T.Vl.FOLDER,status:T.U1.READY,metadata:null,isCorrupted:!1,created_at:null,updated_at:null,last_accessed_at:null}})},validateParentFolderEmpty:async e=>{try{let o=await z({projectRef:w.projectRef,bucketId:w.selectedBucket.id,path:e,options:{limit:200,offset:0,sortBy:{column:w.sortBy,order:w.sortByOrder}}});if(0===o.length){var t;let o="".concat(e,"/").concat(B.ok);await (null==(t=w.supabaseClient)?void 0:t.storage.from(w.selectedBucket.name).upload(o,new File([],B.ok)))}}catch(e){}},deleteFolder:async e=>{try{let t=await w.getAllItemsAlongFolder(e);if(await w.deleteFiles({files:t,isDeleteFolder:!0}),w.popColumnAtIndex(e.columnIndex),w.popOpenedFoldersAtIndex(e.columnIndex-1),e.columnIndex>0){let t=w.openedFolders.slice(0,e.columnIndex).map(e=>e.name).join("/");t.length>0&&await w.validateParentFolderEmpty(t)}await w.refetchAllOpenedFolders(),w.setSelectedItemsToDelete([]),E.oR.success("Successfully deleted ".concat(e.name))}catch(e){E.oR.error("Failed to delete folder: ".concat(e.message))}},renameFolder:async(e,t,o)=>{let a=e.name;if(a===t)return w.updateRowStatus({name:a,status:T.U1.READY,columnIndex:o});let l=(0,E.oR)((0,n.jsx)(J.t,{progress:0,message:"Renaming folder to ".concat(t)}),{closeButton:!1,position:"top-right"});try{if(t.includes("/")||t.includes("\\"))return E.oR.error("Folder name cannot contain forward or back slashes.");w.updateRowStatus({name:a,status:T.U1.LOADING,columnIndex:o,updatedName:t});let r=await w.getAllItemsAlongFolder(e),s=0,c=!1,d=r.map(e=>{let a="".concat(e.prefix,"/").concat(e.name),n=a.split("/"),l=n.slice(0,o).concat(t).concat(n.slice(o+1)).join("/");return()=>new Promise(async e=>{s+=1/r.length;try{await Y({projectRef:w.projectRef,bucketId:w.selectedBucket.id,from:a,to:l})}catch(e){c=!0,E.oR.error("Failed to move ".concat(a," to the new folder"))}e()})}),u=i()(d,2);await u.reduce(async(e,o)=>{await e,await Promise.all(o.map(e=>e())),(0,E.oR)((0,n.jsx)(J.t,{progress:100*s,message:"Renaming folder to ".concat(t)}),{id:l,closeButton:!1,position:"top-right"})},Promise.resolve()),c?E.oR.error("Renamed folder to ".concat(t," with some errors"),{id:l,closeButton:!0,duration:W.j}):E.oR.success("Successfully renamed folder to ".concat(t),{id:l,closeButton:!0,duration:W.j}),w.openedFolders[o].name===e.name&&(w.setSelectedFilePreview(void 0),w.popOpenedFoldersAtIndex(o-1)),await w.refetchAllOpenedFolders()}catch(e){E.oR.error("Failed to rename folder to ".concat(t,": ").concat(e.message),{id:l,closeButton:!0,duration:W.j})}},updateFolderAfterEdit:e=>{let{folderName:t,columnIndex:o,status:a=T.U1.READY}=e,n=void 0!==o?o:w.getLatestColumnIndex(),l=w.columns.map((e,o)=>{if(o===n){let o=e.items.map(e=>{if(e.status===T.U1.EDITING){let o=new Date().toISOString();return{...e,status:a,name:t,createdAt:o,lastAccessedAt:o,updatedAt:o,metadata:null,id:null}}return e});return{...e,items:o}}return e});w.columns=l},downloadFolder:async e=>{let t=0,o=E.oR.loading("Retrieving files from folder...");try{var a;let l=await w.getAllItemsAlongFolder(e);(0,E.oR)((0,n.jsx)(J.t,{progress:0,message:"Downloading ".concat(l.length," file").concat(l.length>1?"s":"","...")}),{id:o,closeButton:!1,position:"top-right"});let r=l.map(e=>{var o,a;let n=null!=(a=null==(o=e.metadata)?void 0:o.mimetype)?a:null;return()=>new Promise(async o=>{try{let a=await (0,G.c)({projectRef:w.projectRef,bucketId:w.selectedBucket.id,path:"".concat(e.prefix,"/").concat(e.name)});t+=1/l.length;let r=await a.blob();o({name:e.name,prefix:e.prefix,blob:new Blob([r],{type:n})})}catch(t){console.error("Failed to download file","".concat(e.prefix,"/").concat(e.name)),o(!1)}})}),s=i()(r,10),c=await s.reduce(async(e,a)=>{let r=await e,s=await Promise.allSettled(a.map(e=>e()));return(0,E.oR)((0,n.jsx)(J.t,{progress:100*t,message:"Downloading ".concat(l.length," file").concat(l.length>1?"s":"","...")}),{id:o,closeButton:!1,position:"top-right"}),r.concat(s.map(e=>e.value).filter(Boolean))},Promise.resolve([])),d=new P.D7("application/zip"),u=new P.Vx(d,{bufferedWrite:!0});0===c.length&&E.oR.error('Failed to download files from "'.concat(e.name,'"'),{id:o,closeButton:!0,duration:W.j}),c.forEach(e=>{e.blob&&u.add("".concat(e.prefix,"/").concat(e.name),new P.nZ(e.blob))});let m=URL.createObjectURL(await u.close()),p=document.createElement("a");p.href=m,p.setAttribute("download","".concat(e.name,".zip")),document.body.appendChild(p),p.click(),null==(a=p.parentNode)||a.removeChild(p),E.oR.success(c.length===l.length?'Successfully downloaded folder "'.concat(e.name,'"'):'Downloaded folder "'.concat(e.name,'". However, ').concat(l.length-c.length," files did not download successfully."),{id:o,closeButton:!0,duration:W.j})}catch(e){E.oR.error("Failed to download folder: ".concat(e.message),{id:o,closeButton:!0,duration:W.j})}},getAllItemsAlongFolder:async e=>{var t,o;let a=[],n=!1,l="",{name:r,columnIndex:s,prefix:i}=e;if(void 0===i){let e=w.openedFolders.slice(0,s).map(e=>e.name).join("/");l=e.length>0?"".concat(e,"/").concat(r):r}else l="".concat(i,"/").concat(r);let c={limit:1e4,offset:0,sortBy:{column:w.sortBy,order:w.sortByOrder}},d=[];for(;;)try{let e=await z({projectRef:w.projectRef,bucketId:w.selectedBucket.id,path:l,options:c});if(d=d.concat(e),c.offset+=c.limit,(e||[]).length<c.limit)break}catch(e){n=!0;break}if(n)throw Error("Failed to retrieve all files within folder");let u=null!=(t=null==d?void 0:d.filter(e=>null===e.id))?t:[];return(null!=(o=null==d?void 0:d.filter(e=>null!==e.id))?o:[]).forEach(e=>a.push({...e,prefix:l})),(await Promise.all(u.map(e=>w.getAllItemsAlongFolder({...e,columnIndex:0,prefix:l})))).map(e=>{e.map(e=>a.push(e))}),a},uploadFiles:async e=>{var t,o,a,l;let{files:s,columnIndex:c,isDrop:d=!1}=e,u=null==(t=(0,L.S)().getQueryCache().find(N.n.storage(w.projectRef)))?void 0:t.state.data,m=null==u?void 0:u.fileSizeLimit,p=new Date,f=d?(await (0,B.Rd)(s)).filter(e=>!e.path.includes("#/")):Array.from(s),h=-1===c?w.getLatestColumnIndex():c,v=void 0!==m?f.filter(e=>e.size<=m):f;if(v.length<f.length){let e=f.length-v.length,{value:t,unit:o}=(0,k.Jb)(m);if(E.oR.error((0,n.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,n.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," beyond the global upload limit of"," ",t,o,"."]}),(0,n.jsxs)("p",{className:"text-foreground-light",children:["You can change the global file size upload limit in"," ",(0,n.jsx)(O.g,{href:"/project/".concat(w.projectRef,"/settings/storage"),children:"Storage settings"}),"."]})]}),{duration:8e3}),e===f.length)return}let y=v.filter(e=>e.size>0);if(y.length<v.length){let e=v.length-y.length;if(E.oR.error((0,n.jsx)("div",{className:"flex flex-col gap-y-1",children:(0,n.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," 0."]})})),e===v.length)return}let I=(null!=(l=null==(a=w.columns)||null==(o=a[h])?void 0:o.items)?l:[]).filter(e=>!e.id).map(e=>e.name),x=v.filter(e=>".DS_Store"!==e.name).map(e=>{if(!e.path)return e;let t=e.path.split("/"),o=t.length>1?t[0]:null;if(I.includes(o)){let a=w.sanitizeNameForDuplicateInColumn({name:o,autofix:!0,columnIndex:c});t[0]=a,e.path=t.join("/")}return e});w.uploadProgresses=Array(x.length).fill({percentage:0,elapsed:0,uploadSpeed:0,remainingBytes:0,remainingTime:0});let R=[],b=x.length,S=0,C=0,j=w.openedFolders.slice(0,h).map(e=>e.name).join("/"),F=w.onUploadProgress(),P=x.map((e,t)=>{var o,a,n;let l=e.name.split(".").pop(),s={mimetype:null!=(o=e.type||function(e){if(void 0!==e)return H[e.toLowerCase()]}(l))?o:"",size:e.size},i={cacheControl:"3600",contentType:s.mimetype},c=(null!=(a=null==e?void 0:e.path)?a:"").split("/").length>1,d=c?e.name:w.sanitizeNameForDuplicateInColumn({name:e.name,autofix:!0}),u=g()(e,["path"])&&c?e.path:d,m=(null!=u?u:"unknown").replaceAll(/\u{202F}/gu," "),p=j.length>0?"".concat(j,"/").concat(m):m;if(c){let t=(null==(n=e.path)?void 0:n.split("/")[0])||"";R.includes(t)||(w.addTempRow({type:T.Vl.FOLDER,name:t,status:T.U1.LOADING,columnIndex:h,metadata:s}),R.push(t))}else w.addTempRow({type:T.Vl.FILE,name:d,status:T.U1.LOADING,columnIndex:h,metadata:s});let f=0,v=w.selectedBucket.name;return()=>new Promise(async(o,a)=>{let n,l=e.size/1048576,c=Date.now();n=Math.min(n=l<30?6291456:l<100?Math.floor(e.size/8):l<500?Math.floor(e.size/10):l<1024?Math.floor(e.size/20):l<10240?Math.floor(e.size/30):Math.floor(e.size/50),524288e3);let d=e.size<=n,u=new A._O(e,{endpoint:w.resumableUploadUrl,retryDelays:[0,200,500,1500,3e3,5e3],headers:{authorization:"Bearer ".concat(w.serviceKey),"x-source":"supabase-dashboard"},uploadDataDuringCreation:d,removeFingerprintOnSuccess:!0,metadata:{bucketName:v,objectName:p,...i},chunkSize:n,onShouldRetry:e=>![400,403,404,409,413,415,429].includes(e.originalResponse?e.originalResponse.getStatus():0),onError:t=>{if(C+=1,t instanceof A.nj){var o,n,l;let a=null==(o=t.originalResponse)?void 0:o.getStatus();415===a?E.oR.error(r()((null==t||null==(n=t.originalResponse)?void 0:n.getBody())||"Failed to upload ".concat(e.name,": ").concat(s.mimetype," is not allowed")),{description:"Allowed MIME types: ".concat(null==(l=w.selectedBucket.allowed_mime_types)?void 0:l.join(", "))}):413===a&&E.oR.error("Failed to upload ".concat(e.name,": File size exceeds the bucket upload limit."))}else E.oR.error("Failed to upload ".concat(e.name,": ").concat(t.message));a(t)},onProgress:(e,o)=>{0===f&&e>n&&(f=e);let a=e-f,l=(Date.now()-c)/1e3,r=a/l,s=o-a;w.uploadProgresses[t]={percentage:0===o?0:e/o,elapsed:l,uploadSpeed:r,remainingBytes:s,remainingTime:s/r},w.onUploadProgress(F)},onSuccess(){S+=1,o()}});return Array.isArray(w.abortUploadCallbacks[F])||(w.abortUploadCallbacks[F]=[]),w.abortUploadCallbacks[F].push(()=>{try{u.abort(!0)}catch(e){}a(Error("Upload aborted by user"))}),u.findPreviousUploads().then(e=>{e.length&&u.resumeFromPreviousUpload(e[0]),u.start()})})}),D=i()(P,10);try{await D.reduce(async(e,t)=>{await e,await Promise.allSettled(t.map(e=>e())),w.onUploadProgress(F)},Promise.resolve()),S>0&&await _({projectRef:w.projectRef,bucketId:w.selectedBucket.id,paths:["".concat(j,"/").concat(B.ok)]}),await w.refetchAllOpenedFolders(),0===b||0===S&&0===C?E.oR.dismiss(F):C===b?E.oR.error("Failed to upload ".concat(b," file").concat(b>1?"s":"","!"),{id:F,closeButton:!0,duration:W.j}):S===b?E.oR.success("Successfully uploaded ".concat(b," file").concat(b>1?"s":"","!"),{id:F,closeButton:!0,duration:W.j}):E.oR.success("Successfully uploaded ".concat(S," out of ").concat(b," file").concat(b>1?"s":"","!"),{id:F,closeButton:!0,duration:W.j})}catch(e){E.oR.error("Failed to upload files",{id:F,closeButton:!0,duration:W.j})}let U=new Date;console.log("Total time taken for ".concat(x.length," files: ").concat((U-p)/1e3," seconds"))},moveFiles:async e=>{let t=d()(e.split("/")).join("/"),o=0;w.clearSelectedItems();let a=(0,E.oR)("Moving ".concat(w.selectedItemsToMove.length," file").concat(w.selectedItemsToMove.length>1?"s":"","..."),{description:"Do not close the browser until it's completed",duration:1/0});await Promise.all(w.selectedItemsToMove.map(async a=>{let n=w.openedFolders.slice(0,a.columnIndex).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(a.name):a.name,r=e.length>0?"".concat(t,"/").concat(a.name):a.name;try{await Y({projectRef:w.projectRef,bucketId:w.selectedBucket.id,from:l,to:r})}catch(e){o+=1,E.oR.error(e.message)}})),o===w.selectedItemsToMove.length?E.oR.error("Failed to move files"):(0,E.oR)("Successfully moved ".concat(w.selectedItemsToMove.length-o," files to ").concat(t.length>0?t:"the root of your bucket")),E.oR.dismiss(a),await w.refetchAllOpenedFolders(),w.setSelectedItemsToMove([])},deleteFiles:async e=>{let{files:t,isDeleteFolder:o=!1}=e;w.setSelectedFilePreview(void 0);let a=0,l=t.some(e=>e.prefix)?t.map(e=>"".concat(e.prefix,"/").concat(e.name)):t.map(e=>{let{name:t,columnIndex:o}=e,a=w.openedFolders.slice(0,o).map(e=>e.name).join("/");return w.updateRowStatus({name:t,status:T.U1.LOADING,columnIndex:o}),a.length>0?"".concat(a,"/").concat(t):t});w.clearSelectedItems();let r=(0,E.oR)((0,n.jsx)(J.t,{progress:0,message:"Deleting ".concat(l.length," file(s)...")}),{closeButton:!1,position:"top-right"}),s=i()(l,2).map(e=>()=>(a+=e.length/l.length,_({projectRef:w.projectRef,bucketId:w.selectedBucket.id,paths:e})));if(await i()(s,2).reduce(async(e,t)=>{await e,await Promise.all(t.map(e=>e())),(0,E.oR)((0,n.jsx)(J.t,{progress:100*a,message:"Deleting ".concat(l.length," file(s)...")}),{id:r,closeButton:!1,position:"top-right"})},Promise.resolve()),o)E.oR.dismiss(r);else{let e=I()(l.map(e=>{let t=e.split("/");return t.slice(0,t.length-1).join("/")}));await Promise.all(e.map(e=>w.validateParentFolderEmpty(e))),E.oR.success("Successfully deleted ".concat(l.length," file(s)"),{id:r,closeButton:!0,duration:W.j,description:void 0}),await w.refetchAllOpenedFolders(),w.setSelectedItemsToDelete([])}},downloadSelectedFiles:async e=>{var t;let o=Math.min(...e.map(e=>e.columnIndex)),a=e.map(e=>{let{name:t,columnIndex:a}=e,n=w.openedFolders.slice(o,a).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(t):t;return{...e,formattedPathToFile:l}}),l=0,r=E.oR.loading("Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")),s=a.map(e=>()=>new Promise(async t=>{let o=await (0,B.PE)({projectRef:w.projectRef,bucketId:w.selectedBucket.id,file:e,returnBlob:!0});l+=1/a.length,y()(o)&&t({...o,name:e.formattedPathToFile}),t(!1)})),c=i()(s,10),d=await c.reduce(async(t,o)=>{let a=await t,s=await Promise.allSettled(o.map(e=>e()));return(0,E.oR)((0,n.jsx)(J.t,{progress:100*l,message:"Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")}),{id:r,closeButton:!1,position:"top-right"}),a.concat(s.map(e=>e.value).filter(Boolean))},Promise.resolve([])),u=new P.D7("application/zip"),m=new P.Vx(u,{bufferedWrite:!0});d.forEach(e=>{m.add(e.name,new P.nZ(e.blob))});let p=URL.createObjectURL(await m.close()),f=document.createElement("a");f.href=p,f.setAttribute("download","supabase-files.zip"),document.body.appendChild(f),f.click(),null==(t=f.parentNode)||t.removeChild(f),E.oR.success("Successfully downloaded ".concat(d.length," files"),{id:r,closeButton:!0,duration:W.j})},renameFile:async(e,t,o)=>{let a=e.name;if(a===t||0===t.length)w.updateRowStatus({name:a,status:T.U1.READY,columnIndex:o});else{w.updateRowStatus({name:a,status:T.U1.LOADING,columnIndex:o,updatedName:t});let l=w.getPathAlongFoldersToIndex(o),r=l.length>0?"".concat(l,"/").concat(a):a,s=l.length>0?"".concat(l,"/").concat(t):t;try{var n;if(await Y({projectRef:w.projectRef,bucketId:w.selectedBucket.id,from:r,to:s}),E.oR.success('Successfully renamed "'.concat(a,'" to "').concat(t,'"')),(null==(n=w.selectedFilePreview)?void 0:n.name)===a){let{previewUrl:o,...a}=e;w.setSelectedFilePreview({...a,name:t})}await w.refetchAllOpenedFolders()}catch(e){E.oR.error("Failed to rename file: ".concat(e.message)),w.updateRowStatus({name:a,status:T.U1.READY,columnIndex:o})}}},selectRangeItems:(e,t)=>{let o=w.columns[e].items,a=o[t],n=w.selectedItems.map(e=>e.id),l=n[n.length-1],r=f()(o,{id:l}),s=Math.min(t,r),i=Math.max(t,r),c=o.slice(s,i+1).map(t=>({...t,columnIndex:e}));if(t<r&&c.reverse(),n.includes(a.id)){let e=c.map(e=>e.id);w.setSelectedItems(w.selectedItems.filter(t=>t.id===a.id||!e.includes(t.id)))}else w.setSelectedItems(R()(w.selectedItems.concat(c),"id"))},sanitizeNameForDuplicateInColumn:e=>{let{name:t,columnIndex:o,autofix:a=!1}=e,n=void 0!==o?o:w.getLatestColumnIndex(),l=w.columns[n].items.filter(e=>e.status!==T.U1.EDITING);if(l.filter(e=>e.name===t).length>0)if(!a)return E.oR.error("The name ".concat(t," already exists in the current directory. Please use a different name.")),null;else{let[e,o]=t.split("."),a=new RegExp("".concat(e," \\([-0-9]+\\)").concat(o?"."+o:"","$")),n=l.filter(e=>e.name.match(a)),r=e+" (".concat(n.length+1,")");return o?"".concat(r,".").concat(o):r}return t},addTempRow:e=>{let{type:t,name:o,status:a,columnIndex:n,metadata:l,isPrepend:r=!1}=e,s=w.columns.map((e,s)=>{if(s===n){let n={type:t,name:o,status:a,metadata:l},s=r?[n].concat(e.items):e.items.concat([n]);return{...e,items:s}}return e});w.columns=s},removeTempRows:e=>{let t=w.columns.map((t,o)=>{if(o===e){let e=t.items.filter(e=>g()(e,"id"));return{...t,items:e}}return t});w.columns=t},onUploadProgress:e=>{let t=w.uploadProgresses.length,o=w.uploadProgresses.reduce((e,t)=>{let{percentage:o}=t;return e+o},0)/t*100,a=(0,B.Uh)(w.uploadProgresses);return(0,E.oR)((0,n.jsx)(J.t,{progress:o,message:"Uploading ".concat(t," file").concat(t>1?"s":"","..."),progressPrefix:"".concat(a&&!isNaN(a)&&isFinite(a)&&0!==a?"".concat((0,B.fU)(a)," remaining â€“ "):""),action:e&&(0,n.jsx)(X.$,{size:"tiny",type:"default",className:"ml-6",onClick:()=>w.abortUploads(e),children:"Cancel"})}),{id:e,closeButton:!1,position:"top-right"})},updateRowStatus:e=>{let{name:t,status:o,columnIndex:a,updatedName:n}=e,l=void 0!==a?a:w.getLatestColumnIndex(),r=w.columns.map((e,a)=>{if(a===l){let a=e.items.map(e=>e.name===t?{...e,status:o,...n&&{name:n}}:e);return{...e,items:a}}return e});w.columns=r}});return w}a=new AbortController;let Q={projectRef:"",resumableUploadUrl:"",serviceKey:"",supabaseClient:void 0},ee=(0,b.createContext)($(Q)),et=e=>{var t,o,a;let{children:l}=e,r=(0,q.KT)(),s=(null==r?void 0:r.status)===V.BU.INACTIVE,[i,c]=(0,b.useState)(()=>$(Q)),d=(0,S.A)(i),{data:u}=(0,U.Gm)({projectRef:null==r?void 0:r.ref}),{serviceKey:m}=(0,U.d6)(u),p=null!=(a=null==u||null==(t=u.app_config)?void 0:t.protocol)?a:"https",f=null==u||null==(o=u.app_config)?void 0:o.endpoint,h="".concat(V.pe?"https":p,"://").concat(f,"/storage/v1/upload/resumable");return(0,b.useEffect)(()=>{let e=(0,C.P9)(d.current),t=!!(null==r?void 0:r.ref),o=e.projectRef!==(null==r?void 0:r.ref);if(!s&&t&&o&&m){var a;let e="".concat(V.pe?"https":p,"://").concat(f),t=(0,F.UU)(e,m.api_key,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storage:{getItem:e=>null,setItem:(e,t)=>{},removeItem:e=>{}}}});c($({projectRef:null!=(a=null==r?void 0:r.ref)?a:"",supabaseClient:t,resumableUploadUrl:h,serviceKey:m.api_key}))}},[null==r?void 0:r.ref,d,m,s]),(0,n.jsx)(ee.Provider,{value:i,"data-sentry-element":"unknown","data-sentry-component":"StorageExplorerStateContextProvider","data-sentry-source-file":"storage-explorer.tsx",children:l})};function eo(e){let t=(0,b.useContext)(ee);return(0,j.s)(t,e)}},51626:(e,t,o)=>{o.d(t,{RE:()=>u,UZ:()=>d});var a=o(80263),n=o(53239),l=o(56028),r=o(12532),s=o(19898);function i(){let e=(0,l.BX)({selectedDatabaseId:void 0,setSelectedDatabaseId:t=>{e.selectedDatabaseId=t}});return e}let c=(0,n.createContext)(i()),d=e=>{let{children:t}=e,o=(0,s.MF)(i);return(0,a.jsx)(c.Provider,{value:o,"data-sentry-element":"unknown","data-sentry-component":"DatabaseSelectorStateContextProvider","data-sentry-source-file":"database-selector.tsx",children:t})};function u(e){let t=(0,n.useContext)(c);return(0,r.s)(t,e)}},64588:(e,t,o)=>{o.d(t,{c:()=>l}),o(73969);var a=o(79140),n=o(64036);let l=async(e,t)=>{let{projectRef:o,bucketId:l,path:r,options:s}=e;if(!l)throw Error("bucketId is required");let i=await (0,a.bE)("".concat(n.H$).concat(n.pe?"":"/platform","/storage/").concat(o,"/buckets/").concat(l,"/objects/download"),{path:r,options:s,abortSignal:t});if(i.error)throw i.error;return i}},73535:(e,t,o)=>{o.d(t,{t:()=>c});var a=o(80263),n=o(8945),l=o(47941),r=o(53239),s=o(51859);let i=r.forwardRef((e,t)=>{let{className:o,value:n,...r}=e;return(0,a.jsx)(l.bL,{ref:t,className:(0,s.cn)("relative h-1 w-full overflow-hidden rounded-full bg-surface-300",o),...r,children:(0,a.jsx)(l.C1,{className:"h-full w-full flex-1 bg-foreground transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});i.displayName=l.bL.displayName;let c=e=>{let{progress:t,progressPrefix:o,action:l,message:r}=e;return(0,a.jsxs)("div",{className:"flex gap-3 w-full","data-sentry-component":"SonnerProgress","data-sentry-source-file":"sonner-progress.tsx",children:[(0,a.jsx)(n.A,{className:"animate-spin text-foreground-muted mt-0.5",size:16,"data-sentry-element":"Loader2","data-sentry-source-file":"sonner-progress.tsx"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex w-full justify-between",children:[(0,a.jsx)("p",{className:"text-foreground text-sm",children:r}),(0,a.jsxs)("p",{className:"text-foreground-light text-sm font-mono",children:[o||"","".concat(Number(t).toFixed(0),"%")]})]}),(0,a.jsx)(i,{value:t,className:"w-full","data-sentry-element":"Progress","data-sentry-source-file":"sonner-progress.tsx"}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center justify-between",children:[(0,a.jsx)("small",{className:"text-foreground-lighter text-xs",children:"Please do not close the browser"}),l]})]})]})}},77952:(e,t,o)=>{o.d(t,{E:()=>a,s:()=>n});let a=0xc80000000;var n=function(e){return e.BYTES="bytes",e.KB="KB",e.MB="MB",e.GB="GB",e}({})},81018:(e,t,o)=>{o.d(t,{JB:()=>n,Jn:()=>d,NA:()=>l,U1:()=>i,Uw:()=>c,Vl:()=>s,Vm:()=>a,ou:()=>r});var a=function(e){return e[e.WEEK=604800]="WEEK",e[e.MONTH=2592e3]="MONTH",e[e.YEAR=31536e3]="YEAR",e}({}),n=function(e){return e.COLUMNS="COLUMNS",e.LIST="LIST",e}({}),l=function(e){return e.NAME="name",e.UPDATED_AT="updated_at",e.CREATED_AT="created_at",e.LAST_ACCESSED_AT="last_accessed_at",e}({}),r=function(e){return e.ASC="asc",e.DESC="desc",e}({}),s=function(e){return e.BUCKET="BUCKET",e.FILE="FILE",e.FOLDER="FOLDER",e}({}),i=function(e){return e.READY="READY",e.LOADING="LOADING",e.EDITING="EDITING",e}({});let c={upload:["INSERT"],download:["SELECT"],list:["SELECT"],update:["SELECT","UPDATE"],move:["SELECT","UPDATE"],copy:["SELECT","INSERT"],remove:["SELECT","DELETE"],createSignedUrl:["SELECT"],createSignedUrls:["SELECT"],getPublicUrl:[]},d={STORAGE_COLUMN:"STORAGE_COLUMN",STORAGE_ITEM:"STORAGE_ITEM",STORAGE_FOLDER:"STORAGE_FOLDER"}},89634:(e,t,o)=>{o.d(t,{Co:()=>x,xd:()=>R});var a=o(80263),n=o(74557),l=o(77796),r=o.n(l),s=o(53239),i=o(56028),c=o(12532),d=o(19898),u=o(68875);let m={open:!1,initialInput:"",sqlSnippets:void 0,suggestions:void 0,tables:[],chats:{},activeChatId:void 0},p="assistantState";async function f(){return(0,n.P2)("ai-assistant-db",1,{upgrade(e){e.objectStoreNames.contains(p)||e.createObjectStore(p,{keyPath:"projectRef"})}})}async function h(e){if(e)try{let t=await f();return await t.get(p,e)}catch(e){console.error("Failed to get AI state from IndexedDB:",e);return}}async function g(e){if(e.projectRef)try{let t=await f();await t.put(p,e)}catch(e){console.error("Failed to save AI state to IndexedDB:",e)}}async function v(e){try{let t=await h(e);if(t)return Object.values(t.chats).forEach(e=>{e&&"object"==typeof e&&(e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt))}),t}catch(e){console.error("Error loading AI state from IndexedDB:",e)}return null}async function y(e){let t=localStorage.getItem(d.rS.AI_ASSISTANT_STATE(e));if(!t)return null;let o=null;try{let n=JSON.parse(t,(e,t)=>("createdAt"===e||"updatedAt"===e)&&t?new Date(t):t);if(n&&"object"==typeof n.chats){var a;o={projectRef:e,open:null!=(a=n.open)&&a,activeChatId:n.activeChatId,chats:n.chats}}else console.warn("Data in localStorage is not in the expected format, ignoring."),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e))}catch(t){console.error("Failed to parse state from localStorage:",t),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e))}if(o)try{return await g(o),localStorage.removeItem(d.rS.AI_ASSISTANT_STATE(e)),o}catch(e){console.error("Failed to save migrated state to IndexedDB:",e)}return null}let w=()=>{let e={...m};{let t=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==t&&(e.open="true"===t)}let t=(0,i.BX)({...e,resetAiAssistantPanel:()=>{Object.assign(t,m)},openAssistant:()=>{t.open=!0},closeAssistant:()=>{t.open=!1},toggleAssistant:()=>{t.open=!t.open},get activeChat(){return t.activeChatId?t.chats[t.activeChatId]:void 0},newChat:e=>{var o,a,n,l,r,s;let i=crypto.randomUUID(),c={id:i,name:null!=(o=null==e?void 0:e.name)?o:"Untitled",messages:[],createdAt:new Date,updatedAt:new Date};return t.chats={...t.chats,[i]:c},t.activeChatId=i,t.open=null!=(a=null==e?void 0:e.open)?a:t.open,t.initialInput=null!=(n=null==e?void 0:e.initialInput)?n:m.initialInput,t.sqlSnippets=null!=(l=null==e?void 0:e.sqlSnippets)?l:m.sqlSnippets,t.suggestions=null!=(r=null==e?void 0:e.suggestions)?r:m.suggestions,t.tables=null!=(s=null==e?void 0:e.tables)?s:m.tables,i},selectChat:e=>{e!==t.activeChatId&&(t.activeChatId=e)},deleteChat:e=>{let{[e]:o,...a}=t.chats;if(t.chats=a,e===t.activeChatId){let e=Object.keys(a);t.activeChatId=e.length>0?e[0]:void 0}},renameChat:(e,o)=>{let a=t.chats[e];a&&a.name!==o&&(a.name=o,a.updatedAt=new Date)},clearMessages:()=>{let e=t.activeChat;e&&(e.messages=[],e.updatedAt=new Date,t.sqlSnippets=[],t.initialInput="")},saveMessage:e=>{let o=t.activeChat;if(!o)return;let a=o.messages,n=Array.isArray(e)?e.filter(e=>!a.some(t=>t.id===e.id)):a.some(t=>t.id===e.id)?[]:[e];n.length>0&&(o.messages.push(...n),o.updatedAt=new Date)},updateMessage:e=>{let{id:o,resultId:a,results:n}=e,l=t.activeChat;if(!l||!a)return;let r=l.messages.findIndex(e=>e.id===o);if(-1!==r){let e=l.messages[r];e.results||(e.results={}),e.results[a]=n}},setSqlSnippets:e=>{t.sqlSnippets=e},clearSqlSnippets:()=>{t.sqlSnippets=void 0,t.suggestions=void 0},getCachedSQLResults:e=>{var o;let{messageId:a,snippetId:n}=e,l=t.activeChat;if(!l||!n)return;let r=l.messages.find(e=>e.id===a);return(null!=(o=null==r?void 0:r.results)?o:{})[n]},loadPersistedState:e=>{t.open=e.open,t.chats=e.chats,t.activeChatId=e.activeChatId;{let e=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==e&&(t.open="true"===e)}if(!t.activeChat){let e=Object.keys(t.chats);e.length>0?t.activeChatId=e.sort((e,o)=>{var a,n;return((null==(a=t.chats[o].updatedAt)?void 0:a.getTime())||0)-((null==(n=t.chats[e].updatedAt)?void 0:n.getTime())||0)})[0]:t.newChat()}}});return t},I=(0,s.createContext)(w()),x=e=>{let{children:t}=e,o=(0,u.KT)(),[n]=(0,s.useState)(()=>w());return(0,s.useEffect)(()=>{let e=!0;return async function(){if(!(null==o?void 0:o.ref)){(null==o?void 0:o.ref)===void 0&&n.resetAiAssistantPanel();return}let t=null;if((t=await v(null==o?void 0:o.ref))||(t=await y(null==o?void 0:o.ref)),e){t&&n.loadPersistedState(t);{let e=new URLSearchParams(window.location.search).get("aiAssistantPanelOpen");null!==e&&(n.open="true"===e)}if(!n.activeChatId||!n.chats[n.activeChatId]){let e=Object.keys(n.chats);e.length>0?n.activeChatId=e.sort((e,t)=>{var o,a;return((null==(o=n.chats[t].updatedAt)?void 0:o.getTime())||0)-((null==(a=n.chats[e].updatedAt)?void 0:a.getTime())||0)})[0]:n.newChat()}}}(),()=>{e=!1}},[null==o?void 0:o.ref,n]),(0,s.useEffect)(()=>{if(null==o?void 0:o.ref){let e=r()(g,500),t=(0,i.B1)(n,()=>{let t=(0,i.P9)(n);e({projectRef:null==o?void 0:o.ref,open:t.open,activeChatId:t.activeChatId,chats:t.chats?Object.entries(t.chats).reduce((e,t)=>{var o;let[a,n]=t;return{...e,[a]:{...n,messages:(null==(o=n.messages)?void 0:o.slice(-20))||[]}}},{}):{}})});return()=>{e.cancel(),t()}}},[n,null==o?void 0:o.ref]),(0,a.jsx)(I.Provider,{value:n,"data-sentry-element":"unknown","data-sentry-component":"AiAssistantStateContextProvider","data-sentry-source-file":"ai-assistant-state.tsx",children:t})},R=e=>{let t=(0,s.useContext)(I);return(0,c.s)(t,e)}},97872:(e,t,o)=>{o.d(t,{Om:()=>f,f2:()=>g,g3:()=>h});var a=o(80263),n=o(53239),l=o(54610),r=o(64036),s=o(89634),i=o(51626),c=o(32036),d=o(42230),u=o(39321),m=o(56163);let p=(0,n.createContext)({project:void 0,isLoading:!0}),f=()=>(0,n.useContext)(p),h=e=>{let{projectRef:t,children:o}=e,{data:r,isLoading:f}=(0,l.wT)({ref:t}),h=(0,n.useMemo)(()=>({project:r,isLoading:f}),[r,f]);return(0,a.jsx)(p.Provider,{value:h,"data-sentry-element":"unknown","data-sentry-component":"ProjectContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(u.by,{"data-sentry-element":"TableEditorStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(m.YD,{"data-sentry-element":"TabsStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(s.Co,{"data-sentry-element":"AiAssistantStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(d.y,{"data-sentry-element":"StorageExplorerStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(i.UZ,{"data-sentry-element":"DatabaseSelectorStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:(0,a.jsx)(c.ME,{"data-sentry-element":"RoleImpersonationStateContextProvider","data-sentry-source-file":"ProjectContext.tsx",children:o},"role-impersonation-state-".concat(t))},"database-selector-state-".concat(t))},"storage-explorer-state-".concat(t))},"ai-assistant-state-".concat(t))},"tabs-state-".concat(t))},"table-editor-state-".concat(t))})},g=()=>{let{project:e}=f();return(null==e?void 0:e.status)===r.BU.ACTIVE_HEALTHY}}}]);