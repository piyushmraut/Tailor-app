!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="55395580-e742-487f-8c22-5afeca5929e9",e._sentryDebugIdIdentifier="sentry-dbid-55395580-e742-487f-8c22-5afeca5929e9")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1959],{2077:(e,t,r)=>{var o=r(95412),n=r(88523),a=r(35256),l=r(2482),s=r(97464),i=r(5689),c=r(33312),u=r(50084),f=r(79661),d=r(27979),p=r(64676),h=r(93118),_=r(63570),y=r(5332),g=r(71641);e.exports=function(e,t,r,m,E,v,b){var I=y(e,r),w=y(t,r),T=b.get(w);if(T)return void o(e,r,T);var A=v?v(I,w,r+"",e,t,b):void 0,R=void 0===A;if(R){var x=c(w),S=!x&&f(w),k=!x&&!S&&_(w);A=w,x||S||k?c(I)?A=I:u(I)?A=l(I):S?(R=!1,A=n(w,!0)):k?(R=!1,A=a(w,!0)):A=[]:h(w)||i(w)?(A=I,i(I)?A=g(I):(!p(I)||d(I))&&(A=s(w))):R=!1}R&&(b.set(w,A),E(A,w,m,v,b),b.delete(w)),o(e,r,A)}},2482:e=>{e.exports=function(e,t){var r=-1,o=e.length;for(t||(t=Array(o));++r<o;)t[r]=e[r];return t}},5332:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},9710:(e,t,r)=>{var o=r(50117),n=r(92685),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var l=e[t];a.call(e,t)&&n(l,r)&&(void 0!==r||t in e)||o(e,t,r)}},14653:(e,t,r)=>{"use strict";var o=r(15599).Buffer;let n=void 0!==o,a=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,l=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function s(e,t,r){null==r&&null!==t&&"object"==typeof t&&(r=t,t=void 0),n&&o.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let s=JSON.parse(e,t);if(null===s||"object"!=typeof s)return s;let c=r&&r.protoAction||"error",u=r&&r.constructorAction||"error";if("ignore"===c&&"ignore"===u)return s;if("ignore"!==c&&"ignore"!==u){if(!1===a.test(e)&&!1===l.test(e))return s}else if("ignore"!==c&&"ignore"===u){if(!1===a.test(e))return s}else if(!1===l.test(e))return s;return i(s,{protoAction:c,constructorAction:u,safe:r&&r.safe})}function i(e,{protoAction:t="error",constructorAction:r="error",safe:o}={}){let n=[e];for(;n.length;){let e=n;for(let a of(n=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(a,"__proto__")){if(!0===o)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete a.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(a,"constructor")&&Object.prototype.hasOwnProperty.call(a.constructor,"prototype")){if(!0===o)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete a.constructor}for(let e in a){let t=a[e];t&&"object"==typeof t&&n.push(t)}}}return e}function c(e,t,r){let o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,r)}finally{Error.stackTraceLimit=o}}e.exports=c,e.exports.default=c,e.exports.parse=c,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=i},21211:(e,t,r)=>{"use strict";e.exports=r(94570)},23069:e=>{e.exports=function(e,t){let r;if("function"!=typeof e)throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let o=0;return function(...n){clearTimeout(r);let a=Date.now(),l=t-(a-o);l<=0?(o=a,e.apply(this,n)):r=setTimeout(()=>{o=Date.now(),e.apply(this,n)},l)}}},35256:(e,t,r)=>{var o=r(59164);e.exports=function(e,t){var r=t?o(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},36115:(e,t,r)=>{var o=r(31152),n=r(95412),a=r(51096),l=r(2077),s=r(64676),i=r(46136),c=r(5332);e.exports=function e(t,r,u,f,d){t!==r&&a(r,function(a,i){if(d||(d=new o),s(a))l(t,r,i,u,e,f,d);else{var p=f?f(c(t,i),a,i+"",t,r,d):void 0;void 0===p&&(p=a),n(t,i,p)}},i)}},39733:(e,t,r)=>{var o=r(64676),n=Object.create;e.exports=function(){function e(){}return function(t){if(!o(t))return{};if(n)return n(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}()},42036:(e,t,r)=>{"use strict";let o,n;r.d(t,{Y_:()=>tl,sQ:()=>ts});var a,l,s=r(53239),i="vercel.ai.error",c=Symbol.for(i),u=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[a]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,i)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};a=c;var f=u,d=Symbol.for("vercel.ai.error.AI_APICallError"),p=Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError"),h="AI_InvalidArgumentError",_=`vercel.ai.error.${h}`,y=Symbol.for(_),g=class extends f{constructor({message:e,cause:t,argument:r}){super({name:h,message:e,cause:t}),this[l]=!0,this.argument=r}static isInstance(e){return f.hasMarker(e,_)}};l=y;var m=Symbol.for("vercel.ai.error.AI_InvalidPromptError"),E=Symbol.for("vercel.ai.error.AI_InvalidResponseDataError"),v=Symbol.for("vercel.ai.error.AI_JSONParseError"),b=Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),I=Symbol.for("vercel.ai.error.AI_LoadSettingError"),w=Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),T=Symbol.for("vercel.ai.error.AI_NoSuchModelError"),A=Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError"),R=Symbol.for("vercel.ai.error.AI_TypeValidationError"),x=Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");function S(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(S):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&S(t)))}let k=(e,t=21)=>(r=t)=>{let o="",n=0|r;for(;n--;)o+=e[Math.random()*e.length|0];return o};var C=r(14653);r(23727);var N=(({prefix:e,size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{let n=k(r,t);if(null==e)return n;if(r.includes(o))throw new g({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${r}".`});return t=>`${e}${o}${n(t)}`})();function O(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var D=Symbol.for("vercel.ai.validator"),j=()=>globalThis.fetch,{btoa:L,atob:F}=globalThis;Symbol("Let zodToJsonSchema decide on which parser to use");let V=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let o={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=o.i?r.source.toLowerCase():r.source,a="",l=!1,s=!1,i=!1;for(let e=0;e<n.length;e++){if(l){a+=n[e],l=!1;continue}if(o.i){if(s){if(n[e].match(/[a-z]/)){i?(a+=n[e],a+=`${n[e-2]}-${n[e]}`.toUpperCase(),i=!1):"-"===n[e+1]&&n[e+2]?.match(/[a-z]/)?(a+=n[e],i=!0):a+=`${n[e]}${n[e].toUpperCase()}`;continue}}else if(n[e].match(/[a-z]/)){a+=`[${n[e]}${n[e].toUpperCase()}]`;continue}}if(o.m){if("^"===n[e]){a+=`(^|(?<=[\r
]))`;continue}else if("$"===n[e]){a+=`($|(?=[\r
]))`;continue}}if(o.s&&"."===n[e]){a+=s?`${n[e]}\r
`:`[${n[e]}\r
]`;continue}a+=n[e],"\\"===n[e]?l=!0:s&&"]"===n[e]?s=!1:s||"["!==n[e]||(s=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a},U=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:M(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},M=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},B=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);var J={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},P={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},$={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},Y={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},W={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},K={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},q={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},G={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},z={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},H={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Q={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},X={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Z={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},ee={code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},et={code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},er=[J,P,$,Y,W,K,q,G,z,H,Q,X,Z,ee,et],eo={[J.code]:J,[P.code]:P,[$.code]:$,[Y.code]:Y,[W.code]:W,[K.code]:K,[q.code]:q,[G.code]:G,[z.code]:z,[H.code]:H,[Q.code]:Q,[X.code]:X,[Z.code]:Z,[ee.code]:ee,[et.code]:et};J.name,J.code,P.name,P.code,$.name,$.code,Y.name,Y.code,W.name,W.code,K.name,K.code,q.name,q.code,G.name,G.code,z.name,z.code,H.name,H.code,Q.name,Q.code,X.name,X.code,Z.name,Z.code,ee.name,ee.code,et.name,et.code;var en=er.map(e=>e.code),ea=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!en.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let o=JSON.parse(e.slice(t+1));return eo[r].parse(o)};async function*el(e,{isAborted:t}={}){let r=new TextDecoder,o=[],n=0;for(;;){let{value:a}=await e.read();if(a&&(o.push(a),n+=a.length,10!==a[a.length-1]))continue;if(0===o.length)break;let l=function(e,t){let r=new Uint8Array(t),o=0;for(let t of e)r.set(t,o),o+=t.length;return e.length=0,r}(o,n);for(let e of(n=0,r.decode(l,{stream:!0}).split("\n").filter(e=>""!==e).map(ea)))yield e;if(null==t?void 0:t()){e.cancel();break}}}function es(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}async function ei({reader:e,abortControllerRef:t,update:r,onToolCall:o,onFinish:n,generateId:a=N,getCurrentDate:l=()=>new Date}){var s;let i,c,u=l(),f={},d=[],p=[],h={},_={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},y="unknown";for await(let{type:n,value:l}of el(e,{isAborted:()=>(null==t?void 0:t.current)===null})){if("error"===n)throw Error(l);if("finish_step"===n){l.isContinued||(i={});continue}if("finish_message"===n){if(y=l.finishReason,null!=l.usage){let{completionTokens:e,promptTokens:t}=l.usage;_={completionTokens:e,promptTokens:t,totalTokens:e+t}}continue}if(null!=i&&("text"===n||"tool_call"===n||"tool_call_streaming_start"===n||"tool_call_delta"===n||"tool_result"===n)&&(f.text&&d.push(f.text),f.function_call&&d.push(f.function_call),f.tool_calls&&d.push(f.tool_calls),f=i,i=void 0),"text"===n&&(f.text?f.text={...f.text,content:(f.text.content||"")+l}:f.text={id:a(),role:"assistant",content:l,createdAt:u}),"tool_call_streaming_start"===n)null==f.text&&(f.text={id:a(),role:"assistant",content:"",createdAt:u}),null==f.text.toolInvocations&&(f.text.toolInvocations=[]),h[l.toolCallId]={text:"",toolName:l.toolName,prefixMapIndex:f.text.toolInvocations.length},f.text.toolInvocations.push({state:"partial-call",toolCallId:l.toolCallId,toolName:l.toolName,args:void 0});else if("tool_call_delta"===n){let e=h[l.toolCallId];e.text+=l.argsTextDelta;let{value:t}=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};try{return{value:C.parse(e),state:"successful-parse"}}catch(t){try{return{value:C.parse(function(e){let t=["ROOT"],r=-1,o=null;function n(e,n,a){switch(e){case'"':r=n,t.pop(),t.push(a),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,o=n,t.pop(),t.push(a),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(a),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(a),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(a),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(a),t.push("INSIDE_ARRAY_START")}}function a(e,o){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=o,t.pop()}}function l(e,o){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop()}}for(let s=0;s<e.length;s++){let i=e[s];switch(t[t.length-1]){case"ROOT":n(i,s,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=s,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(i,s,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":a(i,s);break;case"INSIDE_STRING":switch(i){case'"':t.pop(),r=s;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=s}break;case"INSIDE_ARRAY_START":"]"===i?(r=s,t.pop()):(r=s,n(i,s,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=s,t.pop();break;default:r=s}break;case"INSIDE_ARRAY_AFTER_COMMA":n(i,s,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=s;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=s;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&a(i,s);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&a(i,s);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s);break;default:t.pop()}break;case"INSIDE_LITERAL":{let n=e.substring(o,s+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=s:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?a(i,s):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s))}}}let s=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":s+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":s+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":s+="]";break;case"INSIDE_LITERAL":{let t=e.substring(o,e.length);"true".startsWith(t)?s+="true".slice(t.length):"false".startsWith(t)?s+="false".slice(t.length):"null".startsWith(t)&&(s+="null".slice(t.length))}}return s}(e)),state:"repaired-parse"}}catch(e){}}return{value:void 0,state:"failed-parse"}}(e.text);f.text.toolInvocations[e.prefixMapIndex]={state:"partial-call",toolCallId:l.toolCallId,toolName:e.toolName,args:t},f.text.internalUpdateId=a()}else if("tool_call"===n){if(null!=h[l.toolCallId]?f.text.toolInvocations[h[l.toolCallId].prefixMapIndex]={state:"call",...l}:(null==f.text&&(f.text={id:a(),role:"assistant",content:"",createdAt:u}),null==f.text.toolInvocations&&(f.text.toolInvocations=[]),f.text.toolInvocations.push({state:"call",...l})),f.text.internalUpdateId=a(),o){let e=await o({toolCall:l});null!=e&&(f.text.toolInvocations[f.text.toolInvocations.length-1]={state:"result",...l,result:e})}}else if("tool_result"===n){let e=null==(s=f.text)?void 0:s.toolInvocations;if(null==e)throw Error("tool_result must be preceded by a tool_call");let t=e.findIndex(e=>e.toolCallId===l.toolCallId);if(-1===t)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");e[t]={...e[t],state:"result",...l}}let e=null;"function_call"===n&&(f.function_call={id:a(),role:"assistant",content:"",function_call:l.function_call,name:l.function_call.name,createdAt:u},e=f.function_call);let t=null;"tool_calls"===n&&(f.tool_calls={id:a(),role:"assistant",content:"",tool_calls:l.tool_calls,createdAt:u},t=f.tool_calls),"data"===n&&p.push(...l);let g=f.text;"message_annotations"===n&&(c?c.push(...l):c=[...l],e=es(f.function_call,c),t=es(f.tool_calls,c),g=es(f.text,c),null!=f.text&&(f.text.internalUpdateId=a())),(null==c?void 0:c.length)&&(f.text&&(f.text.annotations=[...c]),f.function_call&&(f.function_call.annotations=[...c]),f.tool_calls&&(f.tool_calls.annotations=[...c])),r([...d,...[e,t,g].filter(Boolean).map(e=>({...es(e,c)}))],[...p])}return null==n||n({message:f.text,finishReason:y,usage:_}),{messages:[f.text,f.function_call,f.tool_calls].filter(Boolean),data:p}}var ec=()=>fetch;async function eu({api:e,body:t,streamProtocol:r="data",credentials:o,headers:n,abortController:a,restoreMessagesOnFailure:l,onResponse:s,onUpdate:i,onFinish:c,onToolCall:u,generateId:f,fetch:d=ec()}){var p,h;let _=await d(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...n},signal:null==(p=null==a?void 0:a())?void 0:p.signal,credentials:o}).catch(e=>{throw l(),e});if(s)try{await s(_)}catch(e){throw e}if(!_.ok)throw l(),Error(null!=(h=await _.text())?h:"Failed to fetch the chat response.");if(!_.body)throw Error("The response body is empty.");let y=_.body.getReader();switch(r){case"text":{let e=ep(),t={id:f(),createdAt:new Date,role:"assistant",content:""};for(;;){let{done:r,value:o}=await y.read();if(r)break;if(t.content+=e(o),i([{...t}],[]),(null==a?void 0:a())===null){y.cancel();break}}return null==c||c(t,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"}),{messages:[t],data:[]}}case"data":return await ei({reader:y,abortControllerRef:null!=a?{current:a()}:void 0,update:i,onToolCall:u,onFinish({message:e,finishReason:t,usage:r}){c&&null!=e&&c(e,{usage:r,finishReason:t})},generateId:f});default:throw Error(`Unknown stream protocol: ${r}`)}}var ef=()=>fetch;async function ed({api:e,prompt:t,credentials:r,headers:o,body:n,streamProtocol:a="data",setCompletion:l,setLoading:s,setError:i,setAbortController:c,onResponse:u,onFinish:f,onError:d,onData:p,fetch:h=ef()}){try{s(!0),i(void 0);let d=new AbortController;c(d),l("");let _=await h(e,{method:"POST",body:JSON.stringify({prompt:t,...n}),credentials:r,headers:{"Content-Type":"application/json",...o},signal:d.signal}).catch(e=>{throw e});if(u)try{await u(_)}catch(e){throw e}if(!_.ok)throw Error(await _.text()||"Failed to fetch the chat response.");if(!_.body)throw Error("The response body is empty.");let y="",g=_.body.getReader();switch(a){case"text":{let e=ep();for(;;){let{done:t,value:r}=await g.read();if(t)break;if(y+=e(r),l(y),null===d){g.cancel();break}}break}case"data":for await(let{type:e,value:t}of el(g,{isAborted:()=>null===d}))switch(e){case"text":y+=t,l(y);break;case"data":null==p||p(t)}break;default:throw Error(`Unknown stream protocol: ${a}`)}return f&&f(t,y),c(null),y}catch(e){if("AbortError"===e.name)return c(null),null;e instanceof Error&&d&&d(e),i(e)}finally{s(!1)}}function ep(e){let t=new TextDecoder;return e?function(e){return t.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(ea).filter(Boolean)}:function(e){return e?t.decode(e,{stream:!0}):""}}async function eh({getStreamedResponse:e,experimental_onFunctionCall:t,experimental_onToolCall:r,updateChatRequest:o,getCurrentMessages:n}){for(;;){let a=await e();if("messages"in a){let e=!1;for(let l of a.messages)if(void 0!==l.function_call&&"string"!=typeof l.function_call||void 0!==l.tool_calls&&"string"!=typeof l.tool_calls){if(e=!0,t){let r=l.function_call;if("object"!=typeof r){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let a=await t(n(),r);if(void 0===a){e=!1;break}o(a)}if(r){let t=l.tool_calls;if(!Array.isArray(t)||t.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let a=await r(n(),t);if(void 0===a){e=!1;break}o(a)}}if(!e)break}else{let e=function(e){for(let t of e.messages){if(void 0!==t.tool_calls)for(let e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};if((void 0===a.function_call||"string"==typeof a.function_call)&&(void 0===a.tool_calls||"string"==typeof a.tool_calls))break;if(t){let r=a.function_call;if("object"!=typeof r){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let l=await t(n(),r);if(void 0===l)break;e(l),o(l)}if(r){let t=a.tool_calls;if("object"!=typeof t){console.warn("experimental_onToolCall should not be defined when using functions");continue}let l=await r(n(),t);if(void 0===l)break;e(l),o(l)}}}}Symbol.for("vercel.ai.schema");var e_=r(21211);let ey=()=>{},eg=ey(),em=Object,eE=e=>e===eg,ev=e=>"function"==typeof e,eb=(e,t)=>({...e,...t}),eI=e=>ev(e.then),ew=new WeakMap,eT=0,eA=e=>{let t,r,o=typeof e,n=e&&e.constructor,a=n==Date;if(em(e)!==e||a||n==RegExp)t=a?e.toJSON():"symbol"==o?e.toString():"string"==o?JSON.stringify(e):""+e;else{if(t=ew.get(e))return t;if(t=++eT+"~",ew.set(e,t),n==Array){for(r=0,t="@";r<e.length;r++)t+=eA(e[r])+",";ew.set(e,t)}if(n==em){t="#";let o=em.keys(e).sort();for(;!eE(r=o.pop());)eE(e[r])||(t+=r+":"+eA(e[r])+",");ew.set(e,t)}}return t},eR=new WeakMap,ex={},eS={},ek="undefined",eC=typeof window!=ek,eN=typeof document!=ek,eO=()=>eC&&typeof window.requestAnimationFrame!=ek,eD=(e,t)=>{let r=eR.get(e);return[()=>!eE(t)&&e.get(t)||ex,o=>{if(!eE(t)){let n=e.get(t);t in eS||(eS[t]=n),r[5](t,eb(n,o),n||ex)}},r[6],()=>!eE(t)&&t in eS?eS[t]:!eE(t)&&e.get(t)||ex]},ej=!0,[eL,eF]=eC&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ey,ey],eV={initFocus:e=>(eN&&document.addEventListener("visibilitychange",e),eL("focus",e),()=>{eN&&document.removeEventListener("visibilitychange",e),eF("focus",e)}),initReconnect:e=>{let t=()=>{ej=!0,e()},r=()=>{ej=!1};return eL("online",t),eL("offline",r),()=>{eF("online",t),eF("offline",r)}}},eU=!s.useId,eM=!eC||"Deno"in window,eB=e=>eO()?window.requestAnimationFrame(e):setTimeout(e,1),eJ=eM?s.useEffect:s.useLayoutEffect,eP="undefined"!=typeof navigator&&navigator.connection,e$=!eM&&eP&&(["slow-2g","2g"].includes(eP.effectiveType)||eP.saveData),eY=e=>{if(ev(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?eA(e):"",t]},eW=0,eK=()=>++eW;var eq={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function eG(...e){let[t,r,o,n]=e,a=eb({populateCache:!0,throwOnError:!0},"boolean"==typeof n?{revalidate:n}:n||{}),l=a.populateCache,s=a.rollbackOnError,i=a.optimisticData,c=e=>"function"==typeof s?s(e):!1!==s,u=a.throwOnError;if(ev(r)){let e=[];for(let o of t.keys())!/^\$(inf|sub)\$/.test(o)&&r(t.get(o)._k)&&e.push(o);return Promise.all(e.map(f))}return f(r);async function f(r){let n,[s]=eY(r);if(!s)return;let[f,d]=eD(t,s),[p,h,_,y]=eR.get(t),g=()=>{let e=p[s];return(ev(a.revalidate)?a.revalidate(f().data,r):!1!==a.revalidate)&&(delete _[s],delete y[s],e&&e[0])?e[0](2).then(()=>f().data):f().data};if(e.length<3)return g();let m=o,E=eK();h[s]=[E,0];let v=!eE(i),b=f(),I=b.data,w=b._c,T=eE(w)?I:w;if(v&&d({data:i=ev(i)?i(T,I):i,_c:T}),ev(m))try{m=m(T)}catch(e){n=e}if(m&&eI(m)){if(m=await m.catch(e=>{n=e}),E!==h[s][0]){if(n)throw n;return m}n&&v&&c(n)&&(l=!0,d({data:T,_c:eg}))}if(l&&!n&&(ev(l)?d({data:l(m,T),error:eg,_c:eg}):d({data:m,error:eg,_c:eg})),h[s][1]=eK(),Promise.resolve(g()).then(()=>{d({_c:eg})}),n){if(u)throw n;return}return m}}let ez=(e,t)=>{for(let r in e)e[r][0]&&e[r][0](t)},eH=(e,t)=>{if(!eR.has(e)){let r=eb(eV,t),o={},n=eG.bind(eg,e),a=ey,l={},s=(e,t)=>{let r=l[e]||[];return l[e]=r,r.push(t),()=>r.splice(r.indexOf(t),1)},i=(t,r,o)=>{e.set(t,r);let n=l[t];if(n)for(let e of n)e(r,o)},c=()=>{if(!eR.has(e)&&(eR.set(e,[o,{},{},{},n,i,s]),!eM)){let t=r.initFocus(setTimeout.bind(eg,ez.bind(eg,o,0))),n=r.initReconnect(setTimeout.bind(eg,ez.bind(eg,o,1)));a=()=>{t&&t(),n&&n(),eR.delete(e)}}};return c(),[e,n,c,a]}return[e,eR.get(e)[4]]},[eQ,eX]=eH(new Map),eZ=eb({onLoadingSlow:ey,onSuccess:ey,onError:ey,onErrorRetry:(e,t,r,o,n)=>{let a=r.errorRetryCount,l=n.retryCount,s=~~((Math.random()+.5)*(1<<(l<8?l:8)))*r.errorRetryInterval;(eE(a)||!(l>a))&&setTimeout(o,s,n)},onDiscarded:ey,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:e$?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:e$?5e3:3e3,compare:(e,t)=>eA(e)==eA(t),isPaused:()=>!1,cache:eQ,mutate:eX,fallback:{}},{isOnline:()=>ej,isVisible:()=>{let e=eN&&document.visibilityState;return eE(e)||"hidden"!==e}}),e0=(e,t)=>{let r=eb(e,t);if(t){let{use:o,fallback:n}=e,{use:a,fallback:l}=t;o&&a&&(r.use=o.concat(a)),n&&l&&(r.fallback=eb(n,l))}return r},e1=(0,s.createContext)({}),e2=eC&&window.__SWR_DEVTOOLS_USE__,e5=e2?window.__SWR_DEVTOOLS_USE__:[],e3=e=>ev(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],e6=()=>eb(eZ,(0,s.useContext)(e1)),e7=e5.concat(e=>(t,r,o)=>{let n=r&&((...e)=>{let[o]=eY(t),[,,,n]=eR.get(eQ);if(o.startsWith("$inf$"))return r(...e);let a=n[o];return eE(a)?r(...e):(delete n[o],a)});return e(t,n,o)}),e9=(e,t,r)=>{let o=t[e]||(t[e]=[]);return o.push(r),()=>{let e=o.indexOf(r);e>=0&&(o[e]=o[o.length-1],o.pop())}};e2&&(window.__SWR_DEVTOOLS_REACT__=s);let e4=s.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),e8={dedupe:!0};em.defineProperty(e=>{let{value:t}=e,r=(0,s.useContext)(e1),o=ev(t),n=(0,s.useMemo)(()=>o?t(r):t,[o,r,t]),a=(0,s.useMemo)(()=>o?n:e0(r,n),[o,r,n]),l=n&&n.provider,i=(0,s.useRef)(eg);l&&!i.current&&(i.current=eH(l(a.cache||eQ),n));let c=i.current;return c&&(a.cache=c[0],a.mutate=c[1]),eJ(()=>{if(c)return c[2]&&c[2](),c[3]},[]),(0,s.createElement)(e1.Provider,eb(e,{value:a}))},"defaultValue",{value:eZ});let te=(n=(e,t,r)=>{let{cache:o,compare:n,suspense:a,fallbackData:l,revalidateOnMount:i,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:f,refreshWhenOffline:d,keepPreviousData:p}=r,[h,_,y,g]=eR.get(o),[m,E]=eY(e),v=(0,s.useRef)(!1),b=(0,s.useRef)(!1),I=(0,s.useRef)(m),w=(0,s.useRef)(t),T=(0,s.useRef)(r),A=()=>T.current,R=()=>A().isVisible()&&A().isOnline(),[x,S,k,C]=eD(o,m),N=(0,s.useRef)({}).current,O=eE(l)?r.fallback[m]:l,D=(e,t)=>{for(let r in N)if("data"===r){if(!n(e[r],t[r])&&(!eE(e[r])||!n(P,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},j=(0,s.useMemo)(()=>{let e=!!m&&!!t&&(eE(i)?!A().isPaused()&&!a&&(!!eE(c)||c):i),r=t=>{let r=eb(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},o=x(),n=C(),l=r(o),s=o===n?l:r(n),u=l;return[()=>{let e=r(x());return D(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>s]},[o,m]),L=(0,e_.useSyncExternalStore)((0,s.useCallback)(e=>k(m,(t,r)=>{D(r,t)||e()}),[o,m]),j[0],j[1]),F=!v.current,V=h[m]&&h[m].length>0,U=L.data,M=eE(U)?O:U,B=L.error,J=(0,s.useRef)(M),P=p?eE(U)?J.current:U:M,$=(!V||!!eE(B))&&(F&&!eE(i)?i:!A().isPaused()&&(a?!eE(M)&&c:eE(M)||c)),Y=!!(m&&t&&F&&$),W=eE(L.isValidating)?Y:L.isValidating,K=eE(L.isLoading)?Y:L.isLoading,q=(0,s.useCallback)(async e=>{let t,o,a=w.current;if(!m||!a||b.current||A().isPaused())return!1;let l=!0,s=e||{},i=!y[m]||!s.dedupe,c=()=>eU?!b.current&&m===I.current&&v.current:m===I.current,u={isValidating:!1,isLoading:!1},f=()=>{S(u)},d=()=>{let e=y[m];e&&e[1]===o&&delete y[m]},p={isValidating:!0};eE(x().data)&&(p.isLoading=!0);try{if(i&&(S(p),r.loadingTimeout&&eE(x().data)&&setTimeout(()=>{l&&c()&&A().onLoadingSlow(m,r)},r.loadingTimeout),y[m]=[a(E),eK()]),[t,o]=y[m],t=await t,i&&setTimeout(d,r.dedupingInterval),!y[m]||y[m][1]!==o)return i&&c()&&A().onDiscarded(m),!1;u.error=eg;let e=_[m];if(!eE(e)&&(o<=e[0]||o<=e[1]||0===e[1]))return f(),i&&c()&&A().onDiscarded(m),!1;let s=x().data;u.data=n(s,t)?s:t,i&&c()&&A().onSuccess(t,m,r)}catch(r){d();let e=A(),{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=r,i&&c()&&(e.onError(r,m,e),(!0===t||ev(t)&&t(r))&&(!A().revalidateOnFocus||!A().revalidateOnReconnect||R())&&e.onErrorRetry(r,m,e,e=>{let t=h[m];t&&t[0]&&t[0](eq.ERROR_REVALIDATE_EVENT,e)},{retryCount:(s.retryCount||0)+1,dedupe:!0})))}return l=!1,f(),!0},[m,o]),G=(0,s.useCallback)((...e)=>eG(o,I.current,...e),[]);if(eJ(()=>{w.current=t,T.current=r,eE(U)||(J.current=U)}),eJ(()=>{if(!m)return;let e=q.bind(eg,e8),t=0,r=e9(m,h,(r,o={})=>{if(r==eq.FOCUS_EVENT){let r=Date.now();A().revalidateOnFocus&&r>t&&R()&&(t=r+A().focusThrottleInterval,e())}else if(r==eq.RECONNECT_EVENT)A().revalidateOnReconnect&&R()&&e();else if(r==eq.MUTATE_EVENT)return q();else if(r==eq.ERROR_REVALIDATE_EVENT)return q(o)});return b.current=!1,I.current=m,v.current=!0,S({_k:E}),$&&(eE(M)||eM?e():eB(e)),()=>{b.current=!0,r()}},[m]),eJ(()=>{let e;function t(){let t=ev(u)?u(x().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!x().error&&(f||A().isVisible())&&(d||A().isOnline())?q(e8).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,f,d,m]),(0,s.useDebugValue)(P),a&&eE(M)&&m){if(!eU&&eM)throw Error("Fallback data is required when using suspense in SSR.");w.current=t,T.current=r,b.current=!1;let e=g[m];if(eE(e)||e4(G(e)),eE(B)){let e=q(e8);eE(P)||(e.status="fulfilled",e.value=!0),e4(e)}else throw B}return{mutate:G,get data(){return N.data=!0,P},get error(){return N.error=!0,B},get isValidating(){return N.isValidating=!0,W},get isLoading(){return N.isLoading=!0,K}}},function(...e){let t=e6(),[r,o,a]=e3(e),l=e0(t,a),s=n,{use:i}=l,c=(i||[]).concat(e7);for(let e=c.length;e--;)s=c[e](s);return s(r,o||l.fetcher||null,l)});var tt=r(23069);function tr(e,t){return null!=t?tt(e,t):e}var to=async(e,t,r,o,n,a,l,s,i,c,u,f,d,p,h,_,y)=>{var g;let m=l.current;r(t.messages,!1);let E=p?t.messages:t.messages.map(({role:e,content:t,experimental_attachments:r,name:o,data:n,annotations:a,toolInvocations:l,function_call:s,tool_calls:i,tool_call_id:c})=>({role:e,content:t,...void 0!==r&&{experimental_attachments:r},...void 0!==o&&{name:o},...void 0!==n&&{data:n},...void 0!==a&&{annotations:a},...void 0!==l&&{toolInvocations:l},tool_call_id:c,...void 0!==s&&{function_call:s},...void 0!==i&&{tool_calls:i}})),v=n.current;return await eu({api:e,body:null!=(g=null==h?void 0:h({messages:t.messages,requestData:t.data,requestBody:t.body}))?g:{messages:E,data:t.data,...a.current.body,...t.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamProtocol:c,credentials:a.current.credentials,headers:{...a.current.headers,...t.headers},abortController:()=>s.current,restoreMessagesOnFailure(){y||r(m,!1)},onResponse:f,onUpdate(e,n){r([...t.messages,...e],!1),o([...null!=v?v:[],...null!=n?n:[]],!1)},onToolCall:d,onFinish:u,generateId:i,fetch:_})};function tn(e){return"assistant"===e.role&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(e=>"result"in e)}async function ta(e){if(null==e)return[];if(e instanceof FileList)return Promise.all(Array.from(e).map(async e=>{let{name:t,type:r}=e;return{name:t,contentType:r,url:await new Promise((t,r)=>{let o=new FileReader;o.onload=e=>{var r;t(null==(r=e.target)?void 0:r.result)},o.onerror=e=>r(e),o.readAsDataURL(e)})}}));if(Array.isArray(e))return e;throw Error("Invalid attachments type")}var tl=function({api:e="/api/chat",id:t,initialMessages:r,initialInput:o="",sendExtraMessageFields:n,experimental_onFunctionCall:a,experimental_onToolCall:l,onToolCall:i,experimental_prepareRequestBody:c,experimental_maxAutomaticRoundtrips:u=0,maxAutomaticRoundtrips:f=u,maxToolRoundtrips:d=f,maxSteps:p=null!=d?d+1:1,streamMode:h,streamProtocol:_,onResponse:y,onFinish:g,onError:m,credentials:E,headers:v,body:b,generateId:I=N,fetch:w,keepLastMessageOnError:T=!1,experimental_throttle:A}={}){h&&(null!=_||(_="text"===h?"text":void 0));let R=(0,s.useId)(),x=null!=t?t:R,S="string"==typeof e?[e,x]:x,[k]=(0,s.useState)([]),{data:C,mutate:O}=te([S,"messages"],null,{fallbackData:null!=r?r:k}),D=(0,s.useRef)(C||[]);(0,s.useEffect)(()=>{D.current=C||[]},[C]);let{data:j,mutate:L}=te([S,"streamData"],null),F=(0,s.useRef)(j);(0,s.useEffect)(()=>{F.current=j},[j]);let{data:V=!1,mutate:U}=te([S,"loading"],null),{data:M,mutate:B}=te([S,"error"],null),J=(0,s.useRef)(null),P=(0,s.useRef)({credentials:E,headers:v,body:b});(0,s.useEffect)(()=>{P.current={credentials:E,headers:v,body:b}},[E,v,b]);let $=(0,s.useCallback)(async t=>{let r=D.current.length;try{U(!0),B(void 0),J.current=new AbortController,await eh({getStreamedResponse:()=>to(e,t,tr(O,A),tr(L,A),F,P,D,J,I,_,g,y,i,n,c,w,T),experimental_onFunctionCall:a,experimental_onToolCall:l,updateChatRequest:e=>{t=e},getCurrentMessages:()=>D.current}),J.current=null}catch(e){if("AbortError"===e.name)return J.current=null,null;m&&e instanceof Error&&m(e),B(e)}finally{U(!1)}let o=D.current,s=o[o.length-1];o.length>r&&null!=s&&p>1&&tn(s)&&function(e){let t=0;for(let r=e.length-1;r>=0;r--)if("assistant"===e[r].role)t++;else break;return t}(o)<p&&await $({messages:o})},[O,U,e,P,y,g,m,B,L,F,_,n,a,l,c,i,p,D,J,I,w,T,A]),Y=(0,s.useCallback)(async(e,{options:t,functions:r,function_call:o,tools:n,tool_choice:a,data:l,headers:s,body:i,experimental_attachments:c}={})=>{var u,f;e.id||(e.id=I());let d=await ta(c),p={headers:null!=s?s:null==t?void 0:t.headers,body:null!=i?i:null==t?void 0:t.body};return $({messages:D.current.concat({...e,id:null!=(u=e.id)?u:I(),createdAt:null!=(f=e.createdAt)?f:new Date,experimental_attachments:d.length>0?d:void 0}),options:p,headers:p.headers,body:p.body,data:l,...void 0!==r&&{functions:r},...void 0!==o&&{function_call:o},...void 0!==n&&{tools:n},...void 0!==a&&{tool_choice:a}})},[$,I]),W=(0,s.useCallback)(async({options:e,functions:t,function_call:r,tools:o,tool_choice:n,data:a,headers:l,body:s}={})=>{if(0===D.current.length)return null;let i={headers:null!=l?l:null==e?void 0:e.headers,body:null!=s?s:null==e?void 0:e.body};return"assistant"===D.current[D.current.length-1].role?$({messages:D.current.slice(0,-1),options:i,headers:i.headers,body:i.body,data:a,...void 0!==t&&{functions:t},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==n&&{tool_choice:n}}):$({messages:D.current,options:i,headers:i.headers,body:i.body,data:a,...void 0!==t&&{functions:t},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==n&&{tool_choice:n}})},[$]),K=(0,s.useCallback)(()=>{J.current&&(J.current.abort(),J.current=null)},[]),q=(0,s.useCallback)(e=>{"function"==typeof e&&(e=e(D.current)),O(e,!1),D.current=e},[O]),G=(0,s.useCallback)(e=>{"function"==typeof e&&(e=e(F.current)),L(e,!1),F.current=e},[L]),[z,H]=(0,s.useState)(o),Q=(0,s.useCallback)(async(e,t={},r)=>{var o,n,a,l,s;if(null==(o=null==e?void 0:e.preventDefault)||o.call(e),!z&&!t.allowEmptySubmit)return;r&&(P.current={...P.current,...r});let i=await ta(t.experimental_attachments),c={headers:null!=(a=t.headers)?a:null==(n=t.options)?void 0:n.headers,body:null!=(s=t.body)?s:null==(l=t.options)?void 0:l.body};$({messages:z||i.length||!t.allowEmptySubmit?D.current.concat({id:I(),createdAt:new Date,role:"user",content:z,experimental_attachments:i.length>0?i:void 0}):D.current,options:c,headers:c.headers,body:c.body,data:t.data}),H("")},[z,I,$]),X=({toolCallId:e,result:t})=>{let r=D.current.map((r,o,n)=>o===n.length-1&&"assistant"===r.role&&r.toolInvocations?{...r,toolInvocations:r.toolInvocations.map(r=>r.toolCallId===e?{...r,result:t}:r)}:r);O(r,!1),tn(r[r.length-1])&&$({messages:r})};return{messages:C||[],setMessages:q,data:j,setData:G,error:M,append:Y,reload:W,stop:K,input:z,setInput:H,handleInputChange:e=>{H(e.target.value)},handleSubmit:Q,isLoading:V,addToolResult:X,experimental_addToolResult:X}},ts=function({api:e="/api/completion",id:t,initialCompletion:r="",initialInput:o="",credentials:n,headers:a,body:l,streamMode:i,streamProtocol:c,fetch:u,onResponse:f,onFinish:d,onError:p,experimental_throttle:h}={}){i&&(null!=c||(c="text"===i?"text":void 0));let _=(0,s.useId)(),y=t||_,{data:g,mutate:m}=te([e,y],null,{fallbackData:r}),{data:E=!1,mutate:v}=te([y,"loading"],null),{data:b,mutate:I}=te([y,"streamData"],null),[w,T]=(0,s.useState)(void 0),[A,R]=(0,s.useState)(null),x=(0,s.useRef)({credentials:n,headers:a,body:l});(0,s.useEffect)(()=>{x.current={credentials:n,headers:a,body:l}},[n,a,l]);let S=(0,s.useCallback)(async(t,r)=>ed({api:e,prompt:t,credentials:x.current.credentials,headers:{...x.current.headers,...null==r?void 0:r.headers},body:{...x.current.body,...null==r?void 0:r.body},streamProtocol:c,fetch:u,setCompletion:tr(e=>m(e,!1),h),onData:tr(e=>I([...null!=b?b:[],...null!=e?e:[]],!1),h),setLoading:v,setError:T,setAbortController:R,onResponse:f,onFinish:d,onError:p}),[m,v,e,x,R,f,d,p,T,b,c,u,I,h]),k=(0,s.useCallback)(()=>{A&&(A.abort(),R(null))},[A]),C=(0,s.useCallback)(e=>{m(e,!1)},[m]),N=(0,s.useCallback)(async(e,t)=>S(e,t),[S]),[O,D]=(0,s.useState)(o),j=(0,s.useCallback)(e=>{var t;return null==(t=null==e?void 0:e.preventDefault)||t.call(e),O?N(O):void 0},[O,N]),L=(0,s.useCallback)(e=>{D(e.target.value)},[D]);return{completion:g,complete:N,error:w,setCompletion:C,stop:k,input:O,setInput:D,handleInputChange:L,handleSubmit:j,isLoading:E,data:b}}},46136:(e,t,r)=>{var o=r(70522),n=r(75850),a=r(89527);e.exports=function(e){return a(e)?o(e,!0):n(e)}},50084:(e,t,r)=>{var o=r(89527),n=r(22363);e.exports=function(e){return n(e)&&o(e)}},58412:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},59164:(e,t,r)=>{var o=r(85985);e.exports=function(e){var t=new e.constructor(e.byteLength);return new o(t).set(new o(e)),t}},69322:(e,t,r)=>{var o=r(92479),n=r(86821);e.exports=function(e){return o(function(t,r){var o=-1,a=r.length,l=a>1?r[a-1]:void 0,s=a>2?r[2]:void 0;for(l=e.length>3&&"function"==typeof l?(a--,l):void 0,s&&n(r[0],r[1],s)&&(l=a<3?void 0:l,a=1),t=Object(t);++o<a;){var i=r[o];i&&e(t,i,o,l)}return t})}},71641:(e,t,r)=>{var o=r(87250),n=r(46136);e.exports=function(e){return o(e,n(e))}},75850:(e,t,r)=>{var o=r(64676),n=r(86458),a=r(58412),l=Object.prototype.hasOwnProperty;e.exports=function(e){if(!o(e))return a(e);var t=n(e),r=[];for(var s in e)"constructor"==s&&(t||!l.call(e,s))||r.push(s);return r}},84513:(e,t,r)=>{var o=r(36115);e.exports=r(69322)(function(e,t,r){o(e,t,r)})},87250:(e,t,r)=>{var o=r(9710),n=r(50117);e.exports=function(e,t,r,a){var l=!r;r||(r={});for(var s=-1,i=t.length;++s<i;){var c=t[s],u=a?a(r[c],e[c],c,r,e):void 0;void 0===u&&(u=e[c]),l?n(r,c,u):o(r,c,u)}return r}},88523:(e,t,r)=>{e=r.nmd(e);var o=r(42468),n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,l=a&&a.exports===n?o.Buffer:void 0,s=l?l.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,o=s?s(r):new e.constructor(r);return e.copy(o),o}},94570:(e,t,r)=>{"use strict";var o=r(53239),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,l=o.useEffect,s=o.useLayoutEffect,i=o.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),o=a({inst:{value:r,getSnapshot:t}}),n=o[0].inst,u=o[1];return s(function(){n.value=r,n.getSnapshot=t,c(n)&&u({inst:n})},[e,r,t]),l(function(){return c(n)&&u({inst:n}),e(function(){c(n)&&u({inst:n})})},[e]),i(r),r};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},95412:(e,t,r)=>{var o=r(50117),n=r(92685);e.exports=function(e,t,r){(void 0===r||n(e[t],r))&&(void 0!==r||t in e)||o(e,t,r)}},97464:(e,t,r)=>{var o=r(39733),n=r(80178),a=r(86458);e.exports=function(e){return"function"!=typeof e.constructor||a(e)?{}:o(n(e))}}}]);